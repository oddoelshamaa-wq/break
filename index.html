html
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙŠØ³ØªÙ… Ø§Ù„Ø¨Ø±ÙŠÙƒØ§Øª (Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø°Ø§ØªÙŠ)</title>
    <!-- Ù…ÙƒØªØ¨Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ² -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f9; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; color: white; margin: 5px; }
        .btn-primary { background-color: #3498db; }
        .btn-danger { background-color: #e74c3c; }
        .btn-success { background-color: #27ae60; }
        .btn-dark { background-color: #34495e; }
        input { padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; margin-bottom: 10px; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading { position: fixed; top:0; left:0; width:100%; height:100%; background:white; display:flex; justify-content:center; align-items:center; z-index:9999; flex-direction: column; text-align: center; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #2c3e50; color: white; }
    </style>
</head>
<body>

<div id="loading">
    <div class="loader"></div>
    <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...</h3>
    <div id="configArea" style="display:none; margin-top:20px; padding:20px; background:#f9f9f9; border:1px solid #ddd; border-radius:10px;">
        <p style="color:red; font-weight:bold;">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø®Ø·Ø£! Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­:</p>
        <p style="font-size:0.9em; color:#555;">(Ù‡ØªÙ„Ø§Ù‚ÙŠÙ‡ ÙÙŠ Firebase Console -> Realtime Database)</p>
        <input type="text" id="manualUrl" placeholder="https://your-project.firebaseio.com/">
        <button onclick="saveUrlAndReload()" class="btn btn-success">Ø­ÙØ¸ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<div class="container hidden" id="mainContainer">
    <!-- Login -->
    <div id="loginSection">
        <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div style="max-width: 400px; margin: auto;">
            <input type="text" id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="attemptLogin()" class="btn btn-primary" style="width:100%">Ø¯Ø®ÙˆÙ„</button>
            <p style="text-align: center; color:#777; font-size:0.8em; margin-top:10px;">Admin: admin / 123</p>
        </div>
    </div>

    <!-- Admin -->
    <div id="adminSection" class="hidden">
        <div style="display:flex; justify-content:space-between;"><h2>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2><button onclick="logout()" class="btn btn-dark">Ø®Ø±ÙˆØ¬</button></div>
        <button onclick="switchTab('monitor')" class="btn btn-primary">Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
        <button onclick="switchTab('users')" class="btn btn-success">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
        <button onclick="switchTab('reports')" class="btn btn-dark">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        
        <div id="tab-monitor">
            <h3>Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­ÙŠØ©</h3>
            <button onclick="endDay()" class="btn btn-danger">Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ÙŠÙˆÙ…</button>
            <table id="monitorTable"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>ØªØ­ÙƒÙ…</th></tr></thead><tbody id="monitorBody"></tbody></table>
        </div>
        
        <div id="tab-users" class="hidden">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h3>
            <input id="nUser" placeholder="User"><input id="nPass" placeholder="Pass"><input id="nName" placeholder="Name">
            <button onclick="addUser()" class="btn btn-success">Ø¥Ø¶Ø§ÙØ©</button>
        </div>

         <div id="tab-reports" class="hidden">
            <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
            <select id="repUser" onchange="renderRep()"><option>Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù</option></select>
            <table id="repTable"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody id="repBody"></tbody></table>
        </div>
    </div>

    <!-- User -->
    <div id="employeeSection" class="hidden">
        <h2 id="welc"></h2>
        <h1 id="timer">00:00</h1>
        <input id="reason" placeholder="Ø§Ù„Ø³Ø¨Ø¨">
        <button onclick="toggleBreak()" class="btn btn-success" id="btnBrk">Ø¨Ø¯Ø¡</button>
        <br><br><button onclick="logout()" class="btn btn-dark">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<script>
    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    let savedUrl = localStorage.getItem('my_db_url');
    // ğŸ‘‡ğŸ‘‡ Ø­Ø· Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§ Ù„Ùˆ Ø¹Ø§Ø±ÙÙ‡ ğŸ‘‡ğŸ‘‡
    let defaultUrl = "https://break-3ccd9-default-rtdb.firebaseio.com/"; 
    
    const config = {
        apiKey: "AIzaSyC2J8fVx7qAz_g33gUNQxXMEJHsWeFrjuk",
        authDomain: "break-3ccd9.firebaseapp.com",
        projectId: "break-3ccd9",
        storageBucket: "break-3ccd9.firebasestorage.app",
        messagingSenderId: "785237776836",
        appId: "1:785237776836:web:0a0062bf07359391fd6c91",
        databaseURL: savedUrl || defaultUrl
    };

    let app, db;
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    try {
        app = firebase.initializeApp(config);
        db = firebase.database();
    } catch(e) { console.log(e); }

    let connected = false;
    let users = {};
    let currentUser = null;

    // Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø§ØªØµØ§Ù„ (Ù„Ùˆ Ø·ÙˆÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ ÙŠØ¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·)
    setTimeout(() => {
        if(!connected) {
            document.querySelector('.loader').style.display = 'none';
            document.querySelector('h3').innerText = "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„!";
            document.getElementById('configArea').style.display = 'block';
        }
    }, 5000);

    function saveUrlAndReload() {
        const url = document.getElementById('manualUrl').value;
        if(url) {
            localStorage.setItem('my_db_url', url);
            location.reload();
        }
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db.ref('.info/connected').on('value', snap => {
        if(snap.val() === true) console.log("Connected!");
    });

    db.ref('users').on('value', snap => {
        connected = true;
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainContainer').classList.remove('hidden');
        users = snap.val() || {};
        checkSession();
        if(!document.getElementById('adminSection').classList.contains('hidden')) renderMon();
        if(currentUser) { currentUser = users[currentUser.username]; upUI(); }
        updateRepSelect();
    });

    // --- Logic ---
    function checkSession() {
        let s = localStorage.getItem('ses');
        if(s === 'admin') showAdmin();
        else if(s && users[s]) { currentUser = users[s]; showEmp(); }
    }

    function attemptLogin() {
        let u = document.getElementById('loginUser').value;
        let p = document.getElementById('loginPass').value;
        if(u=='admin' && p=='123') { localStorage.setItem('ses','admin'); showAdmin(); }
        else if(users[u] && users[u].password == p) { localStorage.setItem('ses',u); currentUser=users[u]; showEmp(); }
        else alert('Ø®Ø·Ø£');
    }

    function showAdmin() { show('adminSection'); renderMon(); }
    function showEmp() { show('employeeSection'); upUI(); document.getElementById('welc').innerText=currentUser.realName; }
    function logout() { localStorage.removeItem('ses'); location.reload(); }
    function show(id) { 
        ['loginSection','adminSection','employeeSection'].forEach(d=>document.getElementById(d).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }
    function switchTab(t) {
        ['tab-monitor','tab-users','tab-reports'].forEach(d=>document.getElementById(d).classList.add('hidden'));
        document.getElementById('tab-'+t).classList.remove('hidden');
    }

    // Admin
    function addUser() {
        let u = document.getElementById('nUser').value;
        let p = document.getElementById('nPass').value;
        let n = document.getElementById('nName').value;
        if(u && p) db.ref('users/'+u).set({username:u, password:p, realName:n, allowance:45, usedSeconds:0, isOnBreak:false});
    }
    function renderMon() {
        let h = '';
        Object.values(users).forEach(u => {
            let t = u.usedSeconds + (u.isOnBreak ? Math.floor((Date.now()-u.lastStartTime)/1000) : 0);
            h += `<tr><td>${u.realName}</td><td>${u.isOnBreak?'â›”':'âœ…'}</td><td>${fmt(t)}</td>
            <td>${u.isOnBreak ? `<button onclick="stop('${u.username}')" class="btn btn-warning">Ø§Ù†Ù‡Ø§Ø¡</button>` : ''}</td></tr>`;
        });
        document.getElementById('monitorBody').innerHTML = h;
    }
    function stop(u) {
        let usr = users[u];
        let d = Math.floor((Date.now()-usr.lastStartTime)/1000);
        db.ref('users/'+u).update({isOnBreak:false, usedSeconds:usr.usedSeconds+d, lastStartTime:null});
    }
    function endDay() {
        if(!confirm('ØªØµÙÙŠØ±ØŸ')) return;
        let today = new Date().toLocaleDateString('ar-EG');
        let up = {};
        Object.values(users).forEach(u => {
            let t = u.usedSeconds + (u.isOnBreak ? Math.floor((Date.now()-u.lastStartTime)/1000) : 0);
            up['users/'+u.username+'/history/'+Date.now()] = {date:today, total:t, allow:u.allowance*60};
            up['users/'+u.username+'/usedSeconds'] = 0;
            up['users/'+u.username+'/isOnBreak'] = false;
        });
        db.ref().update(up);
    }
    
    // Reports
    function updateRepSelect() {
        let s = document.getElementById('repUser');
        s.innerHTML = '<option>Ø§Ø®ØªØ±</option>';
        Object.values(users).forEach(u => s.innerHTML+=`<option value="${u.username}">${u.realName}</option>`);
    }
    function renderRep() {
        let u = users[document.getElementById('repUser').value];
        let h = '';
        if(u.history) Object.values(u.history).reverse().forEach(r => {
            h += `<tr><td>${r.date}</td><td>${fmt(r.total)}</td><td>${r.total > r.allow ? 'ØªØ¬Ø§ÙˆØ²' : 'ØªÙ…Ø§Ù…'}</td></tr>`;
        });
        document.getElementById('repBody').innerHTML = h;
    }

    // User
    function upUI() {
        let t = currentUser.usedSeconds + (currentUser.isOnBreak ? Math.floor((Date.now()-currentUser.lastStartTime)/1000) : 0);
        document.getElementById('timer').innerText = fmt(t);
        let btn = document.getElementById('btnBrk');
        if(currentUser.isOnBreak) { btn.innerText='Ø§Ù†Ù‡Ø§Ø¡'; btn.className='btn btn-danger'; }
        else { btn.innerText='Ø¨Ø¯Ø¡'; btn.className='btn btn-success'; }
        setTimeout(() => { if(!document.getElementById('employeeSection').classList.contains('hidden')) upUI(); }, 1000);
    }
    function toggleBreak() {
        if(!currentUser.isOnBreak) db.ref('users/'+currentUser.username).update({isOnBreak:true, lastStartTime:Date.now(), lastReason: document.getElementById('reason').value});
        else stop(currentUser.username);
    }

    function fmt(s) { return new Date(s * 1000).toISOString().substr(14, 5); }
</script>
</body>
</html>
```
57.2s
Model
ThinkingThoughts
Expand to view model thoughts

chevron_right

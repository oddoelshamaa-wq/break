
                        <!DOCTYPE html>
                        <html lang="ar" dir="rtl">
                        <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠ 2026 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
                            
                            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
                            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
                            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

                            <style>
                                :root {
                                    --bg-deep: #0f172a;
                                    --glass: rgba(255, 255, 255, 0.05);
                                    --glass-border: rgba(255, 255, 255, 0.1);
                                    --primary: #38bdf8;
                                    --accent: #f472b6;
                                    --success: #10b981;
                                    --danger: #ef4444;
                                    --warning: #fbbf24;
                                    --vip-gold: linear-gradient(45deg, #ffd700, #b8860b);
                                    --text-light: #f8fafc;
                                }

                                body { 
                                    font-family: 'Cairo', sans-serif; 
                                    background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%); 
                                    margin: 0; padding: 20px 10px; min-height: 100vh; color: var(--text-light); 
                                    overflow-x: hidden;
                                }

                                /* Ø®Ù„ÙÙŠØ© Aura Ù…ØªØ­Ø±ÙƒØ© */
                                .aura { position: fixed; width: 600px; height: 600px; border-radius: 50%; filter: blur(120px); z-index: -1; opacity: 0.15; animation: move 20s infinite alternate; }
                                .aura-1 { background: var(--primary); top: -200px; left: -200px; }
                                .aura-2 { background: var(--accent); bottom: -200px; right: -200px; animation-delay: -10s; }
                                @keyframes move { from { transform: translate(0,0); } to { transform: translate(100px, 100px); } }

                                @keyframes oxidation-glow {
                                    0% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); background: rgba(239, 68, 68, 0.05); }
                                    50% { box-shadow: 0 0 60px rgba(239, 68, 68, 0.6); background: rgba(239, 68, 68, 0.15); border-color: var(--danger); }
                                    100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); background: rgba(239, 68, 68, 0.05); }
                                }
                                .ÙˆØ¶Ø¹-Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ { animation: oxidation-glow 0.8s infinite !important; }

                                .container { 
                                    max-width: 1200px; margin: auto; background: var(--glass); backdrop-filter: blur(30px);
                                    border-radius: 35px; border: 1px solid var(--glass-border); padding: 30px;
                                    box-shadow: 0 25px 50px rgba(0,0,0,0.5);
                                }

                                /* ØªÙ†Ø³ÙŠÙ‚ ØµÙˆØ± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
                                .profile-img {
                                    width: 45px; height: 45px; border-radius: 50%; object-fit: cover;
                                    border: 2px solid var(--primary); vertical-align: middle; margin-left: 10px;
                                    background: #1e293b;
                                }
                                
                                .profile-pic-container {
                                    position: relative;
                                    display: inline-block;
                                }

                                .profile-img-lg {
                                    width: 90px; height: 90px; border-radius: 50%; object-fit: cover;
                                    border: 3px solid var(--primary); margin-bottom: 15px;
                                    box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
                                    background: #1e293b;
                                    transition: 0.3s;
                                }

                                .change-pic-btn {
                                    position: absolute; bottom: 15px; right: 0;
                                    background: var(--primary); color: white; border: none;
                                    width: 30px; height: 30px; border-radius: 50%;
                                    cursor: pointer; display: flex; align-items: center; justify-content: center;
                                    font-size: 0.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                                    transition: 0.3s;
                                }
                                .change-pic-btn:hover { transform: scale(1.1); background: var(--accent); }

                                /* Ø£Ø²Ø±Ø§Ø± 3D */
                                .btn { 
                                    padding: 12px 18px; border: none; border-radius: 16px; cursor: pointer; 
                                    font-weight: 700; font-family: 'Cairo'; color: white; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                                    display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem;
                                    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
                                }
                                .btn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 12px 20px rgba(0,0,0,0.3); }
                                .btn:active { transform: translateY(2px); }
                                .btn-disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }
                                .btn-primary { background: linear-gradient(135deg, #0ea5e9, #2563eb); }
                                .btn-success { background: linear-gradient(135deg, #10b981, #059669); }
                                .btn-danger { background: linear-gradient(135deg, #ef4444, #b91c1c); }
                                .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: #000; }
                                .btn-vip { background: var(--vip-gold); color: #000; }
                                .btn-dark { background: #334155; }

                                input, select, textarea { 
                                    padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border);
                                    border-radius: 14px; color: white; font-family: 'Cairo'; margin-bottom: 10px; transition: 0.3s;
                                }
                                input:focus { border-color: var(--primary); background: rgba(0,0,0,0.5); outline: none; }

                                /* Ø¬Ø¯Ø§ÙˆÙ„ */
                                .table-responsive { width: 100%; overflow-x: auto; border-radius: 20px; border: 1px solid var(--glass-border); margin-top: 15px; }
                                table { width: 100%; border-collapse: collapse; min-width: 900px; background: rgba(0,0,0,0.2); }
                                th { background: rgba(255,255,255,0.05); color: var(--primary); padding: 15px; font-size: 0.85rem; }
                                td { padding: 12px; border-bottom: 1px solid var(--glass-border); text-align: center; font-size: 0.85rem; }

                                /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ */
                                .timer-container { position: relative; width: 220px; height: 220px; margin: 0 auto; filter: drop-shadow(0 0 15px var(--primary)); }
                                .timer-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
                                .timer-circle-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 12; }
                                .timer-circle-fg { fill: none; stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 1s linear, stroke 0.4s; }
                                .timer-text-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
                                .timer-big-text { font-size: 3.2rem; font-weight: 900; line-height: 1; }

                                /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
                                .employee-hero-grid {
                                    display: grid;
                                    grid-template-columns: 1fr 1fr;
                                    gap: 25px;
                                    align-items: stretch;
                                    margin-bottom: 25px;
                                }

                                .hero-card {
                                    background: rgba(255, 255, 255, 0.03);
                                    border: 1px solid var(--glass-border);
                                    border-radius: 30px;
                                    padding: 30px;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: center;
                                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                                }

                                .broadcast-box {
                                    text-align: right;
                                    height: 100%;
                                }

                                .log-container {
                                    flex: 1;
                                    overflow-y: auto;
                                    max-height: 220px;
                                    margin-top: 10px;
                                    padding-left: 5px;
                                }

                                .broadcast-item {
                                    background: rgba(255,255,255,0.05);
                                    border-right: 4px solid var(--primary);
                                    padding: 12px;
                                    border-radius: 12px;
                                    margin-bottom: 10px;
                                    font-size: 0.9rem;
                                    animation: slideIn 0.3s ease;
                                }

                                @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

                                .welcome-back-msg {
                                    background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(0, 0, 0, 0.4)) !important;
                                    border: 1px solid var(--primary) !important;
                                    color: white !important;
                                    font-weight: bold;
                                    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                                    padding: 15px;
                                    border-radius: 15px;
                                    margin-bottom: 20px;
                                    text-align: center;
                                }

                                @keyframes bounceIn {
                                    0% { transform: scale(0.3); opacity: 0; }
                                    50% { transform: scale(1.05); opacity: 1; }
                                    70% { transform: scale(0.9); }
                                    100% { transform: scale(1); }
                                }

                                .server-clock-box { background: rgba(0,0,0,0.4); padding: 10px 20px; border-radius: 20px; border: 1px solid var(--glass-border); text-align: center; }
                                .clock-time { font-size: 1.3rem; font-weight: 800; color: var(--primary); display: block; }

                                #broadcastOverlay {
                                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95);
                                    z-index: 10000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(20px);
                                }
                                .broadcast-content {
                                    background: #000; border: 4px solid var(--danger); padding: 40px; border-radius: 40px;
                                    max-width: 600px; width: 90%; text-align: center; box-shadow: 0 0 80px var(--danger);
                                }

                                .hidden { display: none !important; }
                                .badge-count { background: var(--danger); color: white; padding: 2px 7px; border-radius: 50%; font-size: 0.7rem; margin-right: 5px; }
                                
                                .fun-title-badge {
                                    display: inline-block;
                                    background: var(--vip-gold);
                                    color: #000;
                                    padding: 5px 15px;
                                    border-radius: 20px;
                                    font-weight: 900;
                                    font-size: 1rem;
                                    margin-top: 5px;
                                    box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
                                    animation: pulseTitle 2s infinite;
                                }
                                @keyframes pulseTitle { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

                                /* =============================================
                                   ØªØ¸Ø¨ÙŠØ· Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Responsive Mobile Style)
                                   ============================================= */
                                @media (max-width: 768px) {

                                    /* 1. Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
                                    .container {
                                        width: 95% !important;
                                        padding: 15px !important;
                                        margin: 10px auto !important;
                                        border-radius: 20px !important;
                                    }

                                    /* 2. Ø§Ù„Ù‡ÙŠØ¯Ø± (ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø²Ø±Ø§ÙŠØ±) */
                                    .header-wrapper {
                                        flex-direction: column !important; /* ÙŠØ±ØµÙ‡Ù… ØªØ­Øª Ø¨Ø¹Ø¶ */
                                        text-align: center !important;
                                        gap: 20px !important;
                                    }

                                    .header-wrapper > div {
                                        justify-content: center !important;
                                        width: 100% !important;
                                        flex-direction: column !important;
                                    }

                                    .digital-clock-container {
                                        margin: 10px auto !important; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø³Ø§Ø¹Ø© */
                                        width: 100% !important;
                                    }

                                    /* 3. Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
                                    .employee-hero-grid {
                                        grid-template-columns: 1fr !important; /* Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ */
                                        gap: 15px !important;
                                    }

                                    /* 4. Ø²Ø±Ø§ÙŠØ± Ø§Ù„ØªØ­ÙƒÙ… (Ø¨Ø±ÙŠÙƒ - ØµÙ„Ø§Ø© - Ù…ÙŠØªÙ†Ø¬) */
                                    #controlsArea > div {
                                        grid-template-columns: 1fr 1fr !important; /* Ø²Ø±Ø§Ø±ÙŠÙ† Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ */
                                    }

                                    /* 5. Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ø¹Ø´Ø§Ù† Ù…ØªØ¨ÙˆØ¸Ø´ Ø§Ù„Ø´ÙƒÙ„) */
                                    .table-responsive {
                                        overflow-x: auto !important; /* Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ù„Ø¹Ø±Ø¶ */
                                        -webkit-overflow-scrolling: touch;
                                    }

                                    table {
                                        min-width: 600px !important; /* Ø¹Ø±Ø¶ Ø£Ø¯Ù†Ù‰ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ù…ÙŠØªÙØ¹ØµØ´ */
                                    }

                                    th, td {
                                        font-size: 0.8rem !important; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ø³Ù†Ø© */
                                        padding: 8px !important;
                                    }

                                    /* 6. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± (Danger Zone) */
                                    #dangerZone {
                                        margin-top: 50px !important;
                                        padding: 20px !important;
                                        width: 100% !important;
                                        box-sizing: border-box !important;
                                    }

                                    #dangerZone div {
                                        flex-direction: column !important; /* Ø§Ù„Ø²Ø±Ø§ÙŠØ± ØªØ­Øª Ø¨Ø¹Ø¶ */
                                        gap: 15px !important;
                                    }

                                    #dangerZone button {
                                        width: 100% !important; /* Ø§Ù„Ø²Ø±Ø§Ø± ÙŠØ§Ø®Ø¯ Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ„Ù‡ */
                                    }

                                    /* 7. Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙˆØ­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
                                    input, select, textarea {
                                        font-size: 16px !important; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù…ÙŠØ¹Ù…Ù„Ø´ Ø²ÙˆÙ… Ù„ÙˆØ­Ø¯Ù‡ */
                                    }

                                    /* 8. ÙˆÙŠØ¯Ø¬Øª Ø§Ù„ØµÙ„Ø§Ø© (ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø´ÙˆÙŠØ©) */
                                    .prayer-toggle-btn {
                                        top: auto !important;
                                        bottom: 120px !important;
                                        left: 0 !important;
                                    }
                                    .prayer-widget.active {
                                        top: auto !important;
                                        bottom: 120px !important;
                                        left: 50px !important;
                                        max-width: 250px !important;
                                    }

                                    /* 9. ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
                                    .aura { display: none !important; } /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© */
                                    h2, h3 { font-size: 1.5rem !important; }

                                    .hero-card { padding: 20px; }
                                    .timer-container { width: 180px; height: 180px; }
                                    .timer-big-text { font-size: 2.5rem; }

                                    .container, .hero-card, .broadcast-content {
                                        backdrop-filter: none !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØºØ¨ÙŠØ´ */
                                        background: rgba(15, 23, 42, 0.95) !important; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø«Ø§Ø¨Øª */
                                    }
                                }

                                /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
                                .form-control-glass {
                                    width: 100%;
                                    background: rgba(0, 0, 0, 0.4);
                                    border: 1px solid var(--glass-border);
                                    color: white;
                                    padding: 15px;
                                    border-radius: 12px;
                                    margin-bottom: 15px;
                                    font-family: 'Cairo', sans-serif;
                                    font-size: 1rem;
                                    outline: none;
                                    transition: 0.3s;
                                    /* Ù„Ø¥ØµÙ„Ø§Ø­ Ø´ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
                                    appearance: none;
                                    -webkit-appearance: none;
                                    -moz-appearance: none;
                                    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
                                    background-repeat: no-repeat;
                                    background-position: left 15px center; /* Ø§Ù„Ø³Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ RTL */
                                    background-size: 15px;
                                }

                                textarea.form-control-glass {
                                    background-image: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³Ù‡Ù… Ù…Ù† Ø§Ù„Ù€ textarea */
                                    resize: vertical;
                                }

                                .form-control-glass:focus {
                                    border-color: var(--primary);
                                    background: rgba(0, 0, 0, 0.6);
                                    box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
                                }

                                /* ØªÙ†Ø³ÙŠÙ‚ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø±ÙØ¹ (Upload Boxes) */
                                .upload-box {
                                    background: rgba(255, 255, 255, 0.05);
                                    border: 1px dashed var(--glass-border);
                                    border-radius: 12px;
                                    padding: 15px;
                                    text-align: center;
                                    transition: 0.3s;
                                }

                                .upload-box:hover {
                                    background: rgba(255, 255, 255, 0.1);
                                    border-color: var(--primary);
                                }

                                .file-name-display {
                                    font-size: 0.8rem;
                                    color: #aaa;
                                    margin-top: 5px;
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                }

                                /* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ÙÙŠØ© */
                                .hidden {
                                    display: none !important;
                                }

                                /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ…ÙŠØ¶ Ù„Ù„Ø²Ø± Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØªÙ†Ø¨ÙŠÙ‡ */
                                @keyframes glow-red {
                                    0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); border-color: #ef4444; }
                                    70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); border-color: #ff0000; }
                                    100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); border-color: #ef4444; }
                                }

                                .alert-mode {
                                    animation: glow-red 1.5s infinite;
                                    background: linear-gradient(135deg, #7f1d1d, #b91c1c) !important; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ØºØ§Ù…Ù‚ */
                                    color: white !important;
                                    font-weight: bold;
                                    transform: scale(1.05); /* ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· */
                                }

                                /* ØªØµÙ…ÙŠÙ… ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
                                .digital-clock-container {
                                    background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
                                    border: 1px solid var(--glass-border);
                                    border-right: 4px solid var(--primary); /* Ø®Ø· Ù…Ù„ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
                                    padding: 10px 20px;
                                    border-radius: 15px;
                                    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
                                    text-align: center;
                                    min-width: 140px;
                                }

                                .digital-time {
                                    font-family: 'Courier New', monospace; /* Ø®Ø· Ø±Ù‚Ù…ÙŠ */
                                    font-size: 1.6rem;
                                    font-weight: 900;
                                    color: var(--primary);
                                    text-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
                                    line-height: 1;
                                    display: block;
                                    margin-bottom: 5px;
                                }

                                .digital-date {
                                    font-size: 0.85rem;
                                    color: #94a3b8;
                                    font-weight: 600;
                                    letter-spacing: 1px;
                                    display: block;
                                }

                                /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) */
                                .edit-pic-badge {
                                    position: absolute;
                                    bottom: 5px;
                                    right: -5px;
                                    width: 30px;
                                    height: 30px;
                                    background: var(--dark);
                                    border: 2px solid var(--primary);
                                    border-radius: 50%;
                                    color: white;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    cursor: pointer;
                                    font-size: 0.9rem;
                                    transition: 0.3s;
                                    z-index: 5;
                                }
                                .edit-pic-badge:hover {
                                    background: var(--primary);
                                    transform: scale(1.1);
                                }

                                /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ØªØ¯Ø®Ù„Ø´ ÙÙŠ Ø¨Ø¹Ø¶ */
                                .header-wrapper {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    background: rgba(255,255,255,0.03);
                                    padding: 15px;
                                    border-radius: 20px;
                                    margin-bottom: 25px;
                                    flex-wrap: wrap;
                                    gap: 15px;
                                }

                        /* ØªØ£Ø«ÙŠØ± Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
                        .the-boss-name {
                            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
                            background-size: 200% auto;
                            color: #fff;
                            background-clip: text;
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            font-weight: 900;
                            font-size: 1.3rem; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· */
                            animation: shine 3s linear infinite; /* Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ù…Ø¹Ø© */
                            text-shadow: 0 0 20px rgba(251, 245, 183, 0.4);
                            font-family: 'Cairo', sans-serif;
                            letter-spacing: 1px;
                        }

                        /* Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ù…Ø¹Ø© */
                        @keyframes shine {
                            to {
                                background-position: 200% center;
                            }
                        }

                        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø¬ */
                        .boss-crown {
                            display: inline-block;
                            font-size: 1.4rem;
                            margin-left: 5px;
                            filter: drop-shadow(0 0 10px gold);
                            animation: crown-float 2s ease-in-out infinite;
                        }

                        /* Ø­Ø±ÙƒØ© Ø§Ù„ØªØ§Ø¬ (ÙŠØ·ÙŠØ± ÙˆÙŠÙ…ÙŠÙ„) */
                        @keyframes crown-float {
                            0%, 100% { transform: translateY(0) rotate(0deg); }
                            50% { transform: translateY(-5px) rotate(10deg); }
                        }

                        /* --- ÙˆÙŠØ¯Ø¬Øª Ø§Ù„ØµÙ„Ø§Ø© --- */
                        .prayer-widget {
                            position: fixed;
                            top: 15%;
                            left: 20px; /* Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
                            width: 220px;
                            background: rgba(15, 23, 42, 0.95);
                            border: 1px solid var(--primary);
                            border-radius: 20px;
                            padding: 15px;
                            z-index: 8000;
                            color: white;
                            box-shadow: 0 0 30px rgba(0,0,0,0.6);
                            backdrop-filter: blur(10px);
                            transition: 0.3s;
                            font-family: 'Cairo', sans-serif;
                            transform: translateX(-240px); /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
                        }

                                /* Ø²Ø± Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆÙŠØ¯Ø¬Øª */
                                .prayer-toggle-btn {
                                    position: fixed;
                                    top: 15%;
                                    left: 0;
                                    width: 40px;
                                    height: 50px;
                                    background: var(--primary);
                                    border-radius: 0 10px 10px 0;
                                    z-index: 8001;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    cursor: pointer;
                                    box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
                                    font-size: 1.2rem;
                                    transition: 0.3s;
                                }
                                .prayer-toggle-btn:hover { padding-left: 5px; }

                                /* ÙƒÙ„Ø§Ø³ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¥Ø¸Ù‡Ø§Ø± */
                                .prayer-widget.active { transform: translateX(0); }
                                .prayer-toggle-btn.active { left: 220px; border-radius: 50%; width: 30px; height: 30px; top: 14%; }

                                .next-prayer-box {
                                    background: rgba(56, 189, 248, 0.1);
                                    border: 1px dashed var(--primary);
                                    border-radius: 12px;
                                    padding: 10px;
                                    text-align: center;
                                    margin-bottom: 15px;
                                }

                                .next-prayer-name { color: var(--warning); font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; }
                                .next-prayer-timer { font-size: 1.4rem; font-weight: 900; color: white; direction: ltr; font-family: monospace; }

                                .prayer-list { list-style: none; padding: 0; margin: 0; font-size: 0.85rem; }
                                .prayer-item {
                                    display: flex; justify-content: space-between;
                                    padding: 8px 5px;
                                    border-bottom: 1px solid rgba(255,255,255,0.1);
                                }
                                .prayer-item:last-child { border-bottom: none; }
                                .prayer-item.current-prayer { color: var(--success); font-weight: bold; background: rgba(16, 185, 129, 0.1); border-radius: 5px; }
                                .prayer-item.next-prayer-highlight { color: var(--warning); font-weight: bold; border-right: 3px solid var(--warning); padding-right: 8px;}

                                @media (max-width: 768px) {
                                    .prayer-widget { top: auto; bottom: 80px; left: 10px; transform: translateX(-250px); }
                                    .prayer-toggle-btn { top: auto; bottom: 100px; }
                                    .prayer-toggle-btn.active { top: auto; bottom: 280px; left: 210px; }
                                }

                                /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø±Ù‚Øµ Ù„Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù„Ù */
                                @keyframes dance {
                                    0%, 100% { transform: rotate(0deg) scale(1); }
                                    25% { transform: rotate(5deg) scale(1.1); }
                                    50% { transform: rotate(-5deg) scale(1.1); }
                                    75% { transform: rotate(3deg) scale(1.1); }
                                }
                                .dance-alert {
                                    animation: dance 0.5s infinite !important;
                                    background: linear-gradient(45deg, #f472b6, #fbbf24) !important; /* Ù„ÙˆÙ† Ø¨ÙŠÙ†Ùƒ ÙÙŠ Ø°Ù‡Ø¨ÙŠ */
                                    border: 2px solid white !important;
                                }

                                /* Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ·ÙŠØ± ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© */
                                .floating-emoji {
                                    position: fixed;
                                    bottom: -100px;
                                    font-size: 2rem;
                                    z-index: 99999;
                                    pointer-events: none;
                                    animation: flyUp 3s linear forwards;
                                }

                                @keyframes flyUp {
                                    to {
                                        transform: translateY(-110vh) rotate(360deg);
                                        opacity: 0;
                                    }
                                }

                                /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© */
                                #funnyToast {
                                    position: fixed;
                                    top: 20px;
                                    left: 50%;
                                    transform: translateX(-50%) translateY(-100px);
                                    background: rgba(255, 255, 255, 0.95);
                                    color: #000;
                                    padding: 15px 30px;
                                    border-radius: 50px;
                                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                                    z-index: 100000;
                                    font-weight: 900;
                                    transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                                    display: flex;
                                    align-items: center;
                                    gap: 10px;
                                    border: 3px solid #f472b6;
                                }
                                #funnyToast.show { transform: translateX(-50%) translateY(20px); }
                            </style>
                        </head>
                        <body>

                        <!-- Ù…Ø¯Ø®Ù„Ø§Øª Ù…Ø®ÙÙŠØ© Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± -->
                        <input type="file" id="selfPicInput" style="display:none" accept="image/*" onchange="handleFileUpload(this, 'self')">
                        <input type="file" id="adminPicInput" style="display:none" accept="image/*" onchange="handleFileUpload(this, 'admin')">

                        <div class="aura aura-1"></div>
                        <div class="aura aura-2"></div>

                        <div id="loading" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center;">
                            <div style="border:5px solid var(--glass-border); border-top:5px solid var(--primary); border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite;"></div>
                            <h3 style="margin-top:20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ...</h3>
                        </div>

                        <audio id="alarmSound" loop preload="auto"><source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg"></audio>
                        <audio id="notifySound" preload="none"><source src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" type="audio/mp3"></audio>
                        <audio id="requestRing" loop preload="none"><source src="https://assets.mixkit.co/active_storage/sfx/1110/1110-preview.mp3" type="audio/mp3"></audio>
                        <audio id="broadcastSound" loop preload="none"><source src="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3" type="audio/mp3"></audio>

                        <!-- ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„ØµÙˆØª Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø© (ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù…ÙŠØ²) -->
                        <audio id="complaintSound" preload="auto">
                            <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mp3">
                        </audio>

                        <div id="forceSoundOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 23, 42, 0.98); z-index:20000; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center;">
                            <div class="broadcast-content" style="border-color: var(--primary); box-shadow: 0 0 50px var(--primary);">
                                <h1 style="color:var(--primary)">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠ 2026</h1>
                                <p>ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©.</p>
                                <button onclick="activateSystemAndSound()" class="btn btn-primary" style="width:100%; padding:20px; font-size:1.3rem; margin-top:20px;">âœ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ§Ù… ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
                            </div>
                        </div>

                        <!-- Ø²Ø± ÙˆÙˆÙŠØ¯Ø¬Øª Ø§Ù„ØµÙ„Ø§Ø© -->
                        <div class="prayer-toggle-btn" onclick="togglePrayerWidget()">ğŸ•Œ</div>

                        <div id="prayerWidget" class="prayer-widget">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                <h4 style="margin:0; color:var(--primary);">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©)</h4>
                            </div>

                            <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
                            <div class="next-prayer-box">
                                <span class="next-prayer-name" id="nextPrayerName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                                <span class="next-prayer-timer" id="nextPrayerCount">--:--:--</span>
                            </div>

                            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙ„ÙˆØ§Øª -->
                            <ul class="prayer-list" id="prayerList">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                            </ul>

                            <div style="font-size:0.7rem; color:#aaa; text-align:center; margin-top:10px;">
                                Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…Ø³Ø§Ø­Ø©
                            </div>
                        </div>

                        <div id="broadcastOverlay">
                            <div class="broadcast-content">
                                <div style="font-size: 5rem;">ğŸš¨</div>
                                <h1 style="color: var(--danger);">ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ Ø¹Ø§Ø¬Ù„</h1>
                                <p id="broadcastMsgText" style="font-size: 1.6rem; font-weight: bold; margin: 25px 0;"></p>
                                <button onclick="acknowledgeBroadcast()" class="btn btn-danger" style="width:100%; padding:20px; font-size:1.3rem;">Ø§Ø³ØªÙ„Ù…Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª)</button>
                            </div>
                        </div>

                        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© -->
                        <div id="funnyToast">ğŸ‘€ <span id="funnyToastText">Ø£ÙˆØ¨Ø§! ÙÙŠ Ù…ÙØ§Ø¬Ø£Ø© Ù†Ø²Ù„Øª ÙÙŠ Ù…Ù„ÙÙƒ Ø¯Ù„ÙˆÙ‚ØªÙŠ!</span> ğŸ˜‚</div>

                        <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ -->
                        <div id="archiveModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:20000; padding:40px; overflow-y:auto;">
                            <div style="max-width:1000px; margin:auto; background:#1e293b; border:1px solid gold; border-radius:20px; padding:30px;">
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                                    <h2 style="color:gold; margin:0;">ğŸ•µï¸ Ø³Ø¬Ù„ Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h2>
                                    <button onclick="document.getElementById('archiveModal').classList.add('hidden')" class="btn btn-danger">Ø¥ØºÙ„Ø§Ù‚</button>
                                </div>

                                <div class="table-responsive">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th style="color:gold">Ø§Ù„Ù…Ø´Ø±Ù (Ø§Ù„ÙØ§Ø¹Ù„)</th>
                                                <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø°Ù</th>
                                                <th>Ø§Ù„Ø¶Ø­ÙŠØ© (Ø§Ù„Ù…ÙˆØ¸Ù)</th>
                                                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                                <th>Ø§Ù„ØªÙˆÙ‚ÙŠØª</th>
                                            </tr>
                                        </thead>
                                        <tbody id="archiveBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰ -->
                        <div id="profileModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:15000; backdrop-filter:blur(10px); overflow-y:auto;">
                            <div style="max-width:800px; margin:50px auto; background:#1e293b; border:1px solid var(--primary); border-radius:25px; padding:30px; position:relative;">
                                <button onclick="closeProfileModal()" style="position:absolute; top:20px; left:20px; background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">âœ–</button>

                                <div style="text-align:center; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:20px; margin-bottom:20px;">
                                    <img id="modalProfilePic" src="" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--primary); object-fit:cover;">
                                    <h2 id="modalRealName" style="margin:10px 0 5px 0; color:var(--primary);"></h2>
                                    <p id="modalUserName" style="color:#aaa; margin:0;"></p>
                                </div>

                                <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© (ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·) -->
                                <div id="adminAddComplaintArea" class="hidden" style="background:rgba(239,68,68,0.1); padding:20px; border-radius:15px; border:1px dashed var(--danger); margin-bottom:25px;">
                                    <h4 style="margin-top:0; color:var(--danger);">ğŸš¨ ØªØ³Ø¬ÙŠÙ„ Ù…Ø®Ø§Ù„ÙØ© / Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©</h4>
                                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                        <input type="text" id="complaintTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ù…Ø«Ù„Ø§Ù‹: ØªØ£Ø®ÙŠØ±ØŒ Ø³ÙˆØ¡ Ø³Ù„ÙˆÙƒ..)">
                                        <input type="number" id="deductionAmount" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… (Ø¥Ù† ÙˆØ¬Ø¯)">
                                    </div>
                                    <textarea id="complaintDetails" style="width:100%; height:80px; margin-top:10px;" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰..."></textarea>

                                    <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
                                        <label style="cursor:pointer; background:var(--dark); padding:10px; border-radius:10px; border:1px solid var(--glass-border);">
                                            ğŸ“· Ø¥Ø±ÙØ§Ù‚ Ø¯Ù„ÙŠÙ„ (Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª)
                                            <input type="file" id="complaintEvidence" accept="image/*" style="display:none" onchange="previewEvidence(this)">
                                        </label>
                                        <span id="evidenceFileName" style="font-size:0.8rem; color:#aaa;"></span>
                                    </div>
                                    <img id="evidencePreview" src="" style="max-height:100px; display:none; margin-top:10px; border-radius:10px; border:1px solid var(--danger);">

                                    <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
                                        <label style="cursor:pointer; background:var(--primary); color:#000; padding:10px; border-radius:10px; border:1px solid var(--glass-border); font-weight:bold;">
                                            ğŸ™ï¸ Ø¥Ø±ÙØ§Ù‚ ØªØ³Ø¬ÙŠÙ„ Ù…ÙƒØ§Ù„Ù…Ø©
                                            <input type="file" id="complaintAudioInput" accept="audio/*" style="display:none" onchange="previewAudio(this)">
                                        </label>
                                        <span id="audioFileName" style="font-size:0.8rem; color:#aaa;"></span>
                                    </div>

                                    <audio id="audioPreviewPlayer" controls style="width:100%; margin-top:10px; display:none; border-radius:20px;"></audio>

                                    <button onclick="submitComplaint()" class="btn btn-danger" style="width:100%; margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© ÙˆØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ù„Ù</button>
                                </div>

                                <!-- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª -->
                                <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:15px;">
                                    <h3 style="color:var(--text-light); margin:0;">ğŸ“‚ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</h3>

                                    <!-- Ù‚Ø³Ù… Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
                                    <div style="display:flex; gap:5px; background:rgba(0,0,0,0.3); padding:5px; border-radius:10px; border:1px solid var(--glass-border);">
                                        <input type="date" id="historyDateFrom" style="margin:0; padding:5px; font-size:0.8rem; width:110px;">
                                        <span style="color:white; align-self:center;">:</span>
                                        <input type="date" id="historyDateTo" style="margin:0; padding:5px; font-size:0.8rem; width:110px;">
                                        <button onclick="renderComplaintsHistory(currentProfileTarget)" class="btn btn-primary btn-sm">ğŸ”</button>
                                        <button onclick="clearHistoryFilters()" class="btn btn-dark btn-sm">âŒ</button>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                                <th>Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©</th>
                                                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                                <th>Ø§Ù„Ø®ØµÙ…</th>
                                                <th>Ø§Ù„Ø¯Ù„ÙŠÙ„</th>
                                                <th>Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                            </tr>
                                        </thead>
                                        <tbody id="complaintsHistoryBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
                        <div id="changePassModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:16000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(10px);">
                            <div style="background:#1e293b; border:1px solid var(--primary); border-radius:25px; padding:30px; width:90%; max-width:400px; text-align:center;">
                                <h3 style="color:var(--primary); margin-bottom:20px;">ğŸ” ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>

                                <input type="password" id="oldPassInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©" class="form-control-glass" style="width:100%;">
                                <input type="password" id="newPassInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="form-control-glass" style="width:100%;">
                                <input type="password" id="confirmPassInput" placeholder="ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="form-control-glass" style="width:100%;">

                                <div style="display:flex; gap:10px; margin-top:20px;">
                                    <button onclick="submitChangePassword()" class="btn btn-success" style="flex:1;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
                                    <button onclick="closePassModal()" class="btn btn-dark" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙ‚Ø· -->
                        <div id="filePassModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:16000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(10px);">
                            <div style="background:#1e293b; border:2px solid var(--accent); border-radius:25px; padding:30px; width:90%; max-width:400px; text-align:center;">
                                <h3 id="filePassTitle" style="color:var(--accent); margin-bottom:20px;">ğŸ”’ Ù‚ÙÙ„ Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ù…Ù„Ù</h3>
                                
                                <div id="oldFilePassArea" class="hidden">
                                    <input type="password" id="oldFilePassInput" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ©" class="form-control-glass" style="width:100%;">
                                </div>
                                
                                <input type="password" id="newFilePassInput" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="form-control-glass" style="width:100%;">
                                <input type="password" id="confirmFilePassInput" placeholder="ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="form-control-glass" style="width:100%;">
                                
                                <p style="font-size: 0.8rem; color: #aaa; margin-bottom: 15px;">Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„Ø­Ù…Ø§ÙŠØ© "Ù…Ù„Ù Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰" ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠØºÙŠØ± Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¯Ø®ÙˆÙ„Ùƒ.</p>

                                <div style="display:flex; gap:10px;">
                                    <button onclick="saveFilePassword()" class="btn btn-primary" style="flex:2; background:var(--accent);">Ø­ÙØ¸ Ø§Ù„Ù‚ÙÙ„</button>
                                    <button onclick="closeFilePassModal()" class="btn btn-dark" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </div>
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
                        <div id="imgZoomModal" class="hidden" onclick="this.classList.add('hidden')" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:20000; display:flex; justify-content:center; align-items:center;">
                            <img id="zoomedImg" src="" style="max-width:90%; max-height:90%; border-radius:10px; box-shadow:0 0 50px rgba(255,255,255,0.2);">
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙØªØ­ Ø§Ù„Ù…Ù„Ù (Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù€ prompt) -->
                        <div id="accessFileModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:17000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(5px);">
                            <div style="background:#1e293b; border:2px solid var(--primary); border-radius:20px; padding:30px; width:90%; max-width:350px; text-align:center;">
                                <h3 style="color:white; margin-bottom:20px;">ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø­Ù…ÙŠ</h3>
                                <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>

                                <input type="password" id="accessFilePassInput" placeholder="â—â—â—â—â—â—" class="form-control-glass" style="width:100%; text-align:center; font-size:1.5rem; letter-spacing: 5px;">

                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <button onclick="confirmAccessFile()" class="btn btn-primary" style="flex:1;">ÙØªØ­ Ø§Ù„Ù…Ù„Ù</button>
                                    <button onclick="closeAccessModal()" class="btn btn-dark" style="flex:1;">Ø¥Ù„ØºØ§Ø¡</button>
                                </div>
                            </div>
                        </div>

                        <div class="container hidden" id="mainContainer">
                            
                            <!-- Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
                            <div id="loginSection" style="max-width: 400px; margin: 80px auto; text-align: center;">
                                <h2 style="font-size: 2rem; margin-bottom: 30px;">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                                <div style="background: var(--glass); padding: 30px; border-radius: 30px; border: 1px solid var(--glass-border);">
                                    <input type="text" id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" style="width:100%">
                                    <input type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%">
                                    <button onclick="attemptLogin()" class="btn btn-primary" style="width:100%; padding: 15px;">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
                                </div>
                            </div>

                            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù -->
                            <div id="adminSection" class="hidden">
                                <div>
                                    <h2 style="margin:0; text-align:right; color:var(--primary); display:inline-block;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸš€</h2>

                                    <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù -->
                                    <span id="currentManagerDisplay" style="font-weight: bold; opacity: 0.7; margin-right: 10px;"></span>

                                    <!-- (ØªÙ… Ø§Ù„Ø­Ø°Ù) ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø³Ù„Ø© ğŸ—‘ï¸ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ -->
                                    <span id="secretResetBtn" onclick="endDay()" class="hidden" style="display:none !important;"></span>

                                    <!-- (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„) Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø£ØµØ¨Ø­ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙ‚Ø· Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø§Ø³Ù… -->
                                    <span id="secretArchiveBtn" onclick="openSecretArchive()" class="hidden" 
                                          style="cursor: pointer; font-size: 1.5rem; margin-right: 10px; vertical-align: middle; transition: 0.3s; filter: drop-shadow(0 0 5px gold);"
                                          title="Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø±ÙŠ"
                                          onmouseover="this.style.transform='scale(1.2)'" 
                                          onmouseout="this.style.transform='scale(1)'">
                                        ğŸ•µï¸
                                    </span>
                                </div>

                                <div style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 25px; padding: 20px; margin-bottom: 25px;">
                                    <h4 style="margin:0 0 15px 0; color:var(--danger)">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¬Ù„Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                        <select id="broadcastTarget" multiple style="height: 100px; width: 100%;">
                                            <option value="all" selected>ğŸ“£ Ù„Ù„Ø¬Ù…ÙŠØ¹</option>
                                        </select>
                                        <textarea id="broadcastInput" style="height: 100px; width: 100%; resize: none;" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..."></textarea>
                                    </div>
                                    <button onclick="sendBroadcast()" class="btn btn-danger" style="width:100%; margin-top: 10px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¢Ù† ğŸš€</button>
                                    <div id="adminBroadcastLog" style="max-height: 80px; overflow-y: auto; margin-top: 10px; font-size: 0.75rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px;"></div>
                                </div>

                                <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px;">
                                    <button onclick="switchAdminTab('monitor')" class="btn btn-primary btn-sm">ğŸ“¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
                                    <button onclick="switchAdminTab('emergency')" class="btn btn-danger btn-sm">ğŸš¨ Ø·ÙˆØ§Ø±Ø¦ <span id="emBadge" class="badge-count hidden">0</span></button>
                                    <button onclick="switchAdminTab('meetings')" class="btn btn-warning btn-sm">ğŸ¤ Ø§Ø¬ØªÙ…Ø§Ø¹ <span id="meetBadge" class="badge-count hidden">0</span></button>
                                    <button onclick="switchAdminTab('overtime')" class="btn btn-primary btn-sm" style="background:#8e44ad">ğŸ•’ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ <span id="otBadge" class="badge-count hidden">0</span></button>
                                    <button onclick="switchAdminTab('reports')" class="btn btn-success btn-sm">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
                                    <button onclick="switchAdminTab('users')" class="btn btn-dark btn-sm">âš™ï¸ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
                                </div>

                                <div id="tab-monitor">
                                    <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 25px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: center;">
                                        <div>ğŸ” Ø­Ø¯ Ø§Ù„Ø¨Ø±ÙŠÙƒ: <input type="number" id="maxBreaksInput" style="width:50px; margin:0;" value="3"></div>
                                        <div>ğŸ•Œ Ø­Ø¯ Ø§Ù„ØµÙ„Ø§Ø©: <input type="number" id="maxPrayersInput" style="width:50px; margin:0;" value="2"></div>
                                        <button onclick="updateLimits()" class="btn btn-primary btn-sm">Ø­ÙØ¸</button>
                                        <div id="statusCountersDisplay" style="font-weight: bold; color: var(--primary); font-size: 1.1rem; border-right: 1px solid var(--glass-border); padding-right: 20px;"></div>
                                    </div>

                                    <!-- Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ù…Ø´Ø±Ù -->
                                    <div style="background: rgba(56, 189, 248, 0.1); padding: 15px; border-radius: 20px; border: 1px solid var(--primary); margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-size: 1.5rem;">ğŸ•Œ</span>
                                            <div>
                                                <h4 style="margin:0; color: var(--primary);">Ù†Ø§ÙØ°Ø© ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©</h4>
                                                <small id="prayerStatusText" style="color: #aaa;">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</small>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <button onclick="setPrayerWindow(true)" class="btn btn-success btn-sm">âœ… ÙØªØ­ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¢Ù†</button>
                                            <button onclick="setPrayerWindow(false)" class="btn btn-danger btn-sm">ğŸ›‘ Ø¥ØºÙ„Ø§Ù‚ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©</button>
                                        </div>
                                    </div>

                                    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© (Ø²Ø± ÙˆØ§Ø­Ø¯ Ù„Ù„Ø¬Ù…ÙŠØ¹) -->
                                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 20px; border: 1px solid var(--success); margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <span style="font-size: 1.8rem;">ğŸ•Œ</span>
                                            <div>
                                                <h4 style="margin:0; color: var(--success);">ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©</h4>
                                                <small style="color: #ccc;">Ø§Ø¶ØºØ· Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø°Ø§Ù† Ù„Ø¥Ø¶Ø§ÙØ© 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</small>
                                            </div>
                                        </div>
                                        <button onclick="addPrayerTimeGlobal()" class="btn btn-success" style="font-weight:bold; padding: 10px 20px;">
                                            â• ØªÙˆØ²ÙŠØ¹ 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ÙƒÙ„
                                        </button>
                                    </div>

                                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                        <input type="text" id="monitorSearch" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù..." style="flex:1" oninput="renderMonitorTable()">
                                        <button onclick="endDay()" class="btn btn-danger btn-sm">Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ÙŠÙˆÙ… ğŸ›‘</button>
                                    </div>

                                    <div class="table-responsive">
                                        <table>
                                            <thead>
                                                <tr><th>Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„Ø¨Ø±ÙŠÙƒ (Ù…ØªØ¨Ù‚ÙŠ)</th><th>ØµÙ„Ø§Ø© / Ù…ØªØ¨Ø¹</th><th>Ù…ÙŠØªÙ†Ø¬ / VIP</th><th>Ø§Ù„ØªØ­ÙƒÙ…</th></tr>
                                            </thead>
                                            <tbody id="monitorBody"></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div id="tab-emergency" class="hidden"><h3>ğŸš¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h3><div class="table-responsive"><table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø±Ø§Ø±</th></tr></thead><tbody id="adminEmBody"></tbody></table></div></div>
                                <div id="tab-meetings" class="hidden"><h3>ğŸ¤ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª</h3><div class="table-responsive"><table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø±Ø§Ø±</th></tr></thead><tbody id="adminMeetBody"></tbody></table></div></div>
                                <div id="tab-overtime" class="hidden"><h3>ğŸ•’ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</h3><div class="table-responsive"><table><thead><tr><th>Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø±Ø§Ø±</th></tr></thead><tbody id="adminOtBody"></tbody></table></div></div>

                                <div id="tab-reports" class="hidden">
                                    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµØ¯ÙŠØ± (Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ) -->
                                    <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 25px; margin-bottom: 20px;">
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end;">
                                            <div><label>Ø§Ù„Ù…ÙˆØ¸Ù:</label><select id="reportUserSelect" style="width:100%"></select></div>
                                            <div><label>Ù…Ù†:</label><input type="date" id="filterStartDate" style="width:100%"></div>
                                            <div><label>Ø¥Ù„Ù‰:</label><input type="date" id="filterEndDate" style="width:100%"></div>
                                            <button onclick="renderUserReport()" class="btn btn-primary">ğŸ” Ø¨Ø­Ø«</button>
                                            <button onclick="exportMonthlyExcel()" class="btn btn-success" style="background:#217346;">ğŸ“Š Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´ÙŠØª Excel</button>
                                        </div>
                                    </div>

                                    <!-- Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) -->
                                    <div class="hidden" id="monthlySummary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px;">
                                        <!-- ... (Ù†ÙØ³ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨ØªØ§Ø¹ØªÙƒ) ... -->
                                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; text-align:center; border:1px solid var(--danger);"><small>Ø§Ù„Ø£ÙƒØ³Ø¯Ø©</small><p id="monthTotalBreaks" style="font-size:1.4rem; color:var(--danger); font-weight:bold;">0 Ø¯</p></div>
                                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; text-align:center;"><small>Ø§Ù„ØµÙ„Ø§Ø©</small><p id="monthTotalPrayer" style="font-size:1.4rem;">0 Ø¯</p></div>
                                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; text-align:center; border:1px solid var(--success);"><small>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</small><p id="monthTotalFollowUp" style="font-size:1.4rem; color:var(--success);">0 Ø¯</p></div>
                                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; text-align:center; border:1px solid #ffd700;"><small>VIP</small><p id="monthTotalVIP" style="font-size:1.4rem; color:#ffd700;">0 Ø¯</p></div>
                                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; text-align:center; border:1px solid var(--primary);"><small>Ø¥Ø¶Ø§ÙÙŠ</small><p id="monthTotalOvertime" style="font-size:1.4rem; color:var(--primary);">0 Ø³</p></div>
                                    </div>

                                    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ) -->
                                    <div class="table-responsive"><table><thead><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø³Ø¬Ù„</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>ØµØ§ÙÙŠ Ø§Ù„Ø£ÙƒØ³Ø¯Ø©</th></tr></thead><tbody id="sessionsReportBody"></tbody></table></div>

            <!-- ======================================================= -->
            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± (Danger Zone) - Ù…Ø¹Ø²ÙˆÙ„Ø© ÙˆØ¨Ø¹ÙŠØ¯Ø© Ø¬Ø¯Ø§Ù‹ -->
            <!-- ======================================================= -->

            <!-- Ù„Ø§Ø­Ø¸: margin-top: 150px Ø¯ÙŠ Ù‡ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ØªØ¨Ø¹Ø¯Ù‡Ø§ Ø¬Ø¯Ø§Ù‹ Ø¹Ù† Ø¥ÙŠØ¯Ùƒ -->
            <div id="dangerZone" class="hidden" style="margin-top: 150px; margin-bottom: 50px; padding: 40px; border: 3px dashed rgba(239, 68, 68, 0.4); border-radius: 30px; background: rgba(0, 0, 0, 0.4); text-align: center;">

                <div style="font-size: 3rem; margin-bottom: 10px;">â˜¢ï¸</div>
                <h3 style="color: var(--danger); margin: 0 0 10px 0; font-weight: 900;">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
                <p style="color: #aaa; margin-bottom: 30px; font-size: 0.9rem;">
                    Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.<br>
                    ØªÙ… ÙˆØ¶Ø¹Ù‡Ø§ Ù‡Ù†Ø§ Ø¹Ù…Ø¯Ø§Ù‹ Ù„ØªÙƒÙˆÙ† Ø¨Ø¹ÙŠØ¯Ø© Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ.
                </p>

                <div style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
                    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙƒØ¨ÙŠØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© -->
                    <button id="rangeDeleteBtn" onclick="deleteReportsInRange()" class="btn btn-warning" style="padding: 15px 40px; font-size: 1.1rem; border: 2px solid #f59e0b;">
                        ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    </button>

                    <button id="masterDeleteBtn" onclick="deleteAllReports()" class="btn btn-danger" style="padding: 15px 40px; font-size: 1.1rem; border: 2px solid #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);">
                        ğŸ”¥ ØªØµÙÙŠØ± ÙˆÙ…Ø³Ø­ Ø§Ù„ÙƒÙ„ (Format)
                    </button>
                </div>

            </div>
                                </div>

                                <div id="tab-users" class="hidden">
                                    <div style="background: var(--glass); padding: 25px; border-radius: 30px; border: 1px dashed var(--glass-border); margin-bottom: 25px;">
                                        <h4>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                            <input type="text" id="newRealName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ">
                                            <input type="text" id="newUsername" placeholder="Username">
                                            <input type="text" id="newPassword" placeholder="Password">
                                            <input type="number" id="newAllowance" value="45">
                                            <input type="text" id="newFunTitle" placeholder="Ø§Ù„Ù„Ù‚Ø¨ (Ù…Ø«Ù„Ø§Ù‹: Ø£Ø´Ø·Ø± ÙƒØªÙƒÙˆØª)" style="border-color: var(--vip-gold);">
                                            
                                            <div style="grid-column: span 2; display: flex; gap: 5px;">
                                                <input type="text" id="newProfilePic" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²" style="flex:1">
                                                <button onclick="document.getElementById('adminPicInput').click()" class="btn btn-dark">ğŸ“ Ø±ÙØ¹</button>
                                            </div>
                                        </div>
                            <div style="margin: 15px 0; display: flex; gap: 20px;">
                                <label style="color:#ffd700"><input type="checkbox" id="isVIPUser"> â­ VIP</label>
                                <label style="color:var(--success)"><input type="checkbox" id="canFollowUp"> ğŸ“ Ù…ØªØ§Ø¨Ø¹Ø©</label>

                                <!-- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø®ÙŠØ§Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
                                <label style="color:var(--primary); font-weight:bold; border:1px solid var(--primary); padding:0 10px; border-radius:10px;">
                                    <input type="checkbox" id="isCSAgent"> ğŸ§ Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ (Ù…ÙƒØ§Ù„Ù…Ø§Øª + Ø¨Ø±ÙŠÙƒ ÙÙ‚Ø·)
                                </label>
                            </div>
                                        <button onclick="saveUser()" id="saveUserBtn" class="btn btn-success" style="width:100%">Ø­ÙØ¸</button>
                                    </div>
                                    <div class="table-responsive"><table><thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>User</th>
                                <!-- ØªÙ… Ø¥Ø¶Ø§ÙØ© ID Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ù‡Ø§ -->
                                <th id="headerUserPass">Pass</th>
                                <th id="headerFilePass" style="color:var(--accent)">Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù</th>
                                <th>Ø§Ù„Ù…Ø¯Ø©</th>
                                <th>Ø§Ù„Ù„Ù‚Ø¨/Ø§Ù„Ø¯Ù„Ø¹</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead><tbody id="usersManagementBody"></tbody></table></div>
                                </div>
                            </div>

                            <!-- ================= Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù ================= -->
                            <div id="employeeSection" class="hidden">
                                <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø¸Ù… -->
                                <div class="header-wrapper">

                                    <!-- Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                                    <div style="display: flex; align-items: center; gap: 20px;">

                                        <!-- ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ø¹ Ø²Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
                                        <div class="profile-pic-container" style="position: relative;">
                                            <img id="userProfilePicDisplay" src="" class="profile-img-lg" style="margin:0;">

                                            <!-- Ø²Ø± 1: ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) -->
                                            <button onclick="updateMyProfilePic()" class="edit-pic-badge" title="ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©">ğŸ“·</button>
                                        </div>

                                        <!-- Ø§Ù„Ø§Ø³Ù… ÙˆØ²Ø± Ø§Ù„Ù…Ù„Ù -->
                                        <div>
                                            <h2 id="welcomeMsg" style="margin:0; font-size:1.4rem; line-height:1.2;"></h2>
                                            <div id="userFunTitleDisplay"></div>

                                            <!-- Ø²Ø± 2: Ù…Ù„Ù Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…ÙˆØ¸Ù) -->
                                            <button id="myProfileBtn" onclick="openMyProfile()" class="btn btn-dark btn-sm" style="margin-top:8px; position:relative; border:1px solid var(--glass-border);">
                                                ğŸ“‚ Ù…Ù„ÙÙŠ ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰
                                                <span id="profileNotificationBadge" class="hidden" style="position:absolute; top:-8px; left:-8px; background:red; color:white; border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:0.7rem;">0</span>
                                            </button>

                                            <button onclick="openFilePassModal(false)" class="btn btn-dark btn-sm" style="margin-top:8px; border:1px solid var(--accent); color:var(--accent);">
                                                ğŸ”‘ ØªØºÙŠÙŠØ± Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø´Ù…Ø§Ù„: Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div class="digital-clock-container">
                                            <span id="userServerTime" class="digital-time">00:00:00</span>
                                            <span id="userServerDate" class="digital-date">10/01/2026</span>
                                        </div>

                                        <button onclick="logout()" class="btn btn-danger btn-sm" style="height: 45px; width: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);" title="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                                <polyline points="16 17 21 12 16 7"></polyline>
                                                <line x1="21" y1="12" x2="9" y2="12"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
                                <div class="employee-hero-grid">
                                    <div class="hero-card">
                                        <div id="welcomeBackArea"></div>
                                        <div class="timer-container">
                                            <svg class="timer-svg">
                                                <circle cx="110" cy="110" r="100" class="timer-circle-bg"></circle>
                                                <circle cx="110" cy="110" r="100" class="timer-circle-fg" id="timerCircle" stroke-dasharray="628" stroke-dashoffset="0"></circle>
                                            </svg>
                                            <div class="timer-text-overlay">
                                                <div class="timer-big-text" id="userTimer">00:00</div>
                                                <div id="timerLabel">Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠÙƒ</div>
                                            </div>
                                        </div>
                                        <h3 id="userStatusMsg" style="color: var(--success); text-align: center; margin-top: 15px;">Ù…ØªØ§Ø­ âœ…</h3>
                                        <div id="overtimeAlert" class="hidden" style="background: var(--danger); padding: 10px; border-radius: 15px; margin-top: 10px;">âš ï¸ Ø£ÙƒØ³Ø¯Ø©!</div>
                                    </div>
                                    <div class="hero-card broadcast-box">
                                        <h4 style="color:var(--primary); border-bottom:1px solid var(--glass-border); padding-bottom:10px;">ğŸ”” Ø§Ù„ØªÙˆØ¬ÙŠÙ‡Ø§Øª</h4>
                                        <div id="employeeBroadcastLog" class="log-container"></div>
                                    </div>
                                </div>

                                <!-- ØµÙ†Ø¯ÙˆÙ‚ ØªÙ†Ø¨ÙŠÙ‡ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø¯ -->
                                <div id="breakLimitAlert" style="display:none; background:rgba(220, 38, 38, 0.2); border:1px solid #ef4444; color:#ffcccc; padding:15px; border-radius:15px; margin:15px 0; text-align:center; font-weight:bold; animation: pulse 2s infinite;">
                                </div>

                                <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± (Ù‡Ù†Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ employeeSection) -->
                                <div style="background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 30px; padding: 25px; text-align: center;">
                                    
                                    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© / Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
                                    <div id="csAgentDashboard" class="hidden" style="margin-top:20px;">
                                        <div style="background:rgba(56, 189, 248, 0.1); border:1px solid var(--primary); padding:20px; border-radius:20px; margin-bottom:25px;">
                                            <h3 style="margin-top:0; color:var(--primary); display:flex; align-items:center; gap:10px;">
                                                ğŸ§ Ø±ÙØ¹ ØªÙ‚ÙŠÙŠÙ… Ù…ÙƒØ§Ù„Ù…Ø© (Quality Assurance)
                                            </h3>
                                            
                                            <select id="csTargetUser" class="form-control-glass">
                                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>
                                            </select>

                                            <input type="text" id="csCallTitle" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©" class="form-control-glass">
                                            <textarea id="csCallNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© / Ø§Ù„ØªÙ‚ÙŠÙŠÙ…..." class="form-control-glass" style="height:80px;"></textarea>
                                            
                                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                                                <div class="upload-box">
                                                    <label style="cursor:pointer; display:block; text-align:center; color:var(--primary);">
                                                        ğŸ™ï¸ Ù…Ù„Ù Ø§Ù„ØµÙˆØª
                                                        <input type="file" id="csAudioInput" accept="audio/*" style="display:none" onchange="previewCsAudio(this)">
                                                    </label>
                                                    <div id="csAudioName" class="file-name-display"></div>
                                                </div>
                                                <div class="upload-box">
                                                    <label style="cursor:pointer; display:block; text-align:center; color:var(--warning);">
                                                        ğŸ–¼ï¸ Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª
                                                        <input type="file" id="csImageInput" accept="image/*" style="display:none" onchange="previewCsImage(this)">
                                                    </label>
                                                    <div id="csImageName" class="file-name-display"></div>
                                                </div>
                                            </div>
                                            <img id="csImagePreview" src="" style="display:none; width:100px; height:100px; object-fit:cover; border-radius:10px; margin:0 auto 15px auto; border:2px solid var(--warning);">
                                            <button onclick="uploadCsCall()" class="btn btn-primary" style="width:100%;">ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù</button>
                                        </div>
                                    </div>

                                    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù -->
                                    <div id="controlsArea">
                                        <input type="text" id="breakReason" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ù†Ø´Ø§Ø· Ù‡Ù†Ø§..." class="form-control-glass" style="text-align: center; font-size: 1.1rem;">
                                        
                                        <div id="vipControlArea" class="hidden" style="margin-bottom: 20px;">
                                            <button onclick="startMyBreak('Ø§Ø³ØªØ±Ø§Ø­Ø© VIP')" class="btn btn-vip" style="width:100%; max-width:500px;">ğŸ‘‘ Ø¨Ø¯Ø¡ Ø§Ø³ØªØ±Ø§Ø­Ø© VIP</button>
                                        </div>

                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; max-width: 800px; margin: 0 auto;">
                                            <div style="border:1px solid var(--success); padding:8px; border-radius:15px;"><h4>ğŸ” Ø¨Ø±ÙŠÙƒ</h4><button onclick="startMyBreak('Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…')" class="btn btn-success" style="width:100%">Ø§Ø¨Ø¯Ø£</button></div>
                                            <div style="border:1px solid var(--primary); padding:8px; border-radius:15px;"><h4>ğŸ•Œ ØµÙ„Ø§Ø©</h4><button onclick="startMyBreak('ØµÙ„Ø§Ø©')" class="btn btn-primary" style="width:100%">Ø§Ø¨Ø¯Ø£</button></div>
                                            <div style="border:1px solid var(--warning); padding:8px; border-radius:15px;"><h4>ğŸ¤ Ù…ÙŠØªÙ†Ø¬</h4><div id="meetingStatusArea"><button onclick="sendMeetingRequest()" class="btn btn-warning" style="width:100%">Ø·Ù„Ø¨</button></div></div>
                                            <div id="followUpCard" class="hidden" style="border:1px solid #10b981; padding:8px; border-radius:15px;"><h4>ğŸ“ Ù…ØªØ§Ø¨Ø¹</h4><button onclick="startMyBreak('Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„')" class="btn btn-success" style="width:100%; background:#10b981;">Ø§Ø¨Ø¯Ø£</button></div>
                                            <div style="border:1px solid var(--danger); padding:8px; border-radius:15px;"><h4>ğŸš¨ Ø·ÙˆØ§Ø±Ø¦</h4><div id="emStatusArea"><button onclick="sendEmRequest()" class="btn btn-danger" style="width:100%">Ø·Ù„Ø¨</button></div></div>
                                        </div>

                                        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ -->
                                        <div style="margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 25px; border: 1px solid var(--glass-border); max-width: 500px; margin: 25px auto 0;">
                                            <h4 style="margin:0 0 10px 0; color:var(--primary)">ğŸ’¼ Ø·Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ</h4>
                                            <div style="display: flex; gap: 10px;">
                                                <input type="number" id="otHoursInput" placeholder="Ø³Ø§Ø¹Ø§Øª" class="form-control-glass" style="margin:0; flex:1">
                                                <button onclick="sendOtRequest()" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„</button>
                                            </div>
                                            <p id="otStatusDisplay"></p>
                                        </div>
                                    </div>

                                    <!-- Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù -->
                                    <div id="stopArea" class="hidden">
                                        <button onclick="stopMyBreak()" class="btn btn-danger" style="padding: 25px; width: 100%; max-width: 600px; font-size: 1.6rem; border-radius: 25px;">ğŸ›‘ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            // ØªÙƒÙˆÙŠÙ† Firebase
                            const firebaseConfig = {
                                apiKey: "AIzaSyC2J8fVx7qAz_g33gUNQxXMEJHsWeFrjuk",
                                authDomain: "break-3ccd9.firebaseapp.com",
                                projectId: "break-3ccd9",
                                storageBucket: "break-3ccd9.firebasestorage.app",
                                messagingSenderId: "785237776836",
                                appId: "1:785237776836:web:0a0062bf07359391fd6c91",
                                databaseURL: "https://break-3ccd9-default-rtdb.firebaseio.com/"
                            };

                            let db;
                            try { firebase.initializeApp(firebaseConfig); db = firebase.database(); } catch(e) { console.error(e); }

                            let allUsersData = {}, currentUser = null, timerInterval = null, isLoaded = false;
                            let adminTypingBuffer = {}, adminSelectBuffer = {}, editingUserKey = null, soundActive = false;
                            let maxBreaksAllowed = 3, maxPrayersAllowed = 2, lastReceivedBroadcastID = localStorage.getItem('last_broadcast_id') || "";
                            let currentProfileTarget = null; // Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ Ù†Ø¹Ø±Ø¶ Ù…Ù„ÙÙ‡ Ø­Ø§Ù„ÙŠØ§Ù‹
                            let csAudioBase64 = null;
                            let csImageBase64 = null;
                            let lastUnreadCount = 0; // Ù…ØªØºÙŠØ± Ù„ØªØ°ÙƒØ± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
                            let pendingProfileUser = null;
                            let isPrayerWindowOpen = false;

                            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
                            // 1. Ø¯Ù‡ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù„ÙŠ Ø¬Ø¨ØªÙ‡ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨ØªØ§Ø¹ØªÙƒ
                            const CLOUD_NAME = "dr2ekwtae";

                            // 2. Ø¯Ù‡ Ù„Ø§Ø²Ù… ØªØ¬ÙŠØ¨Ù‡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø²ÙŠ Ù…Ø§ Ø´Ø±Ø­ØªÙ„Ùƒ ÙÙˆÙ‚ (ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ Unsigned)
                            const UPLOAD_PRESET = "my_preset";

                            // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹ (Ø¨ØªØ¶ØºØ· Ø§Ù„ØµÙˆØ± Ø¹Ø´Ø§Ù† Ù…Ø§ØªØ³Ø­Ø¨Ø´ Ù†Øª)
                            async function uploadToCloudinary(file) {
                                if (!file) return null;

                                const formData = new FormData();
                                formData.append("file", file);
                                formData.append("upload_preset", UPLOAD_PRESET);

                                // Ø¯Ù‡ Ø³Ø·Ø± Ø³Ø­Ø±ÙŠ: Ø¨ÙŠØ®Ù„ÙŠ Cloudinary ÙŠØµØºØ± Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‡Ùˆ Ø¨ÙŠØ±ÙØ¹Ù‡Ø§
                                // Ø¹Ø´Ø§Ù† Ø§Ù„Ø±ÙØ¹ ÙŠØ®Ù„Øµ ÙÙŠ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø§ ÙŠØ¹Ù„Ù‚Ø´
                                if (file.type.startsWith('image')) {
                                    formData.append("transformation", "w_800,q_auto:good");
                                }

                                try {
                                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
                                        method: "POST",
                                        body: formData
                                    });

                                    if (!response.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");

                                    const data = await response.json();
                                    return data.secure_url; // Ø¨ÙŠØ±Ø¬Ø¹ Ø±Ø§Ø¨Ø· Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹
                                } catch (error) {
                                    console.error("Upload Error:", error);
                                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Øª Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØŒ Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ.");
                                    return null;
                                }
                            }

                            // 1. ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¢Ù…Ù†Ø©
                            function openUserProfile(username) {
                                const u = allUsersData[username];
                                if(!u) return;

                                const isAdmin = MANAGERS.includes(currentUser.username);
                                const isOwner = (currentUser.username === username);

                                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ù‡Ùˆ Ù…Ù† ÙŠÙØªØ­ Ù…Ù„ÙÙ‡
                                if (!isAdmin && isOwner) {
                                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¨Ø¹Ø¯
                                    if (!u.filePassword) {
                                        alert("ğŸ”’ Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ø®ØµÙˆØµÙŠØ© Ù…Ù„ÙÙƒ Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ø§Ù„Ø¢Ù†.");
                                        openFilePassModal(true);
                                        return;
                                    }

                                    // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† promptØŒ Ù†ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¢Ù…Ù†Ø©
                                    pendingProfileUser = username;
                                    document.getElementById('accessFilePassInput').value = ''; // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚Ù„
                                    document.getElementById('accessFileModal').classList.remove('hidden');
                                    document.getElementById('accessFilePassInput').focus();
                                    return;
                                }

                                // Ù„Ùˆ Ø£Ø¯Ù…Ù†ØŒ ÙŠÙØªØ­ Ø¹Ù„Ø·ÙˆÙ„
                                loadProfileData(username);
                            }

                            // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                            function confirmAccessFile() {
                                const inputPass = document.getElementById('accessFilePassInput').value;
                                const u = allUsersData[pendingProfileUser];

                                if (inputPass === u.filePassword) {
                                    document.getElementById('accessFileModal').classList.add('hidden');
                                    loadProfileData(pendingProfileUser); // ÙØªØ­ Ø§Ù„Ù…Ù„Ù
                                } else {
                                    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
                                    document.getElementById('accessFilePassInput').value = '';
                                }
                            }

                            function closeAccessModal() {
                                document.getElementById('accessFileModal').classList.add('hidden');
                                pendingProfileUser = null;
                            }

                            // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙØµÙ„Ù†Ø§Ù‡Ø§ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡)
                            function loadProfileData(username) {
                                currentProfileTarget = username;
                                const u = allUsersData[username];
                                const isAdmin = MANAGERS.includes(currentUser.username);

                                document.getElementById('profileModal').classList.remove('hidden');
                                document.getElementById('modalRealName').innerText = u.realName || username;
                                document.getElementById('modalUserName').innerText = `@${u.username}`;
                                document.getElementById('modalProfilePic').src = u.profilePic || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';

                                if (isAdmin) {
                                    document.getElementById('adminAddComplaintArea').classList.remove('hidden');
                                } else {
                                    document.getElementById('adminAddComplaintArea').classList.add('hidden');
                                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
                                    if (u.complaints) {
                                        Object.keys(u.complaints).forEach(key => {
                                            if (!u.complaints[key].seen && !u.complaints[key].acknowledged) {
                                                db.ref(`users/${username}/complaints/${key}`).update({ seen: true });
                                            }
                                        });
                                    }
                                }

                                // ØªØµÙÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
                                clearHistoryFilters(false);
                                renderComplaintsHistory(username);
                            }

                            // Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ±
                            function clearHistoryFilters(reload = true) {
                                document.getElementById('historyDateFrom').value = '';
                                document.getElementById('historyDateTo').value = '';
                                if(reload && currentProfileTarget) renderComplaintsHistory(currentProfileTarget);
                            }

                            // 2. ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙ„ØªØ±Ø© + Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ø°Ù Ø¹Ù† abutamim)
                            function renderComplaintsHistory(username) {
                                const tbody = document.getElementById('complaintsHistoryBody');
                                tbody.innerHTML = '';

                                if (!allUsersData[username]) return;

                                const u = allUsersData[username];
                                const viewingMyOwnProfile = (currentUser.username === username);
                                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø°Ù (Ø£Ø¯Ù…Ù† ÙˆÙ„ÙŠØ³ Ø£Ø¨Ùˆ ØªÙ…ÙŠÙ…ØŒ Ø£Ùˆ ÙŠÙƒÙˆÙ† Ù…Ø­Ù…ÙˆØ¯ Ø£Ùˆ Ø£Ø­Ù…Ø¯)
                                const canDelete = (currentUser.role === 'admin' && currentUser.username !== 'abutamim') || ['mahmoud', 'ahmed'].includes(currentUser.username);

                                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
                                const filterFrom = document.getElementById('historyDateFrom').value;
                                const filterTo = document.getElementById('historyDateTo').value;

                                if (u.complaints) {
                                    const keys = Object.keys(u.complaints).reverse().slice(0, 50);

                                    keys.forEach(key => {
                                        const c = u.complaints[key];

                                        // Ù…Ù†Ø·Ù‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
                                        if (filterFrom || filterTo) {
                                            // ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´ÙƒÙˆÙ‰ Ù…Ù† DD/MM/YYYY Ø¥Ù„Ù‰ YYYY-MM-DD Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                                            const parts = c.date.split('/');
                                            const cDateISO = `${parts[2]}-${parts[1]}-${parts[0]}`;

                                            if (filterFrom && cDateISO < filterFrom) return; // ØªØ®Ø·ÙŠ
                                            if (filterTo && cDateISO > filterTo) return; // ØªØ®Ø·ÙŠ
                                        }

                                        let actionCell = '';

                                        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª
                                        if (c.acknowledged) {
                                            actionCell += `<div style="color:#10b981; font-weight:bold; font-size:0.9rem;">âœ” ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>`;
                                        } else if (c.seen) {
                                            if (currentUser.role === 'admin') {
                                                actionCell += `<div style="color:#3b82f6; font-size:0.85rem;">ğŸ‘ï¸ Ø´Ø§Ù‡Ø¯Ù‡Ø§</div>`;
                                            } else if (viewingMyOwnProfile) {
                                                actionCell += `<button onclick="acknowledgeComplaint('${key}')" class="btn btn-vip btn-sm" style="animation: pulse 2s infinite;">âœ Ù…ÙˆØ§ÙÙ‚</button>`;
                                            }
                                        } else {
                                            if (currentUser.role === 'admin') {
                                                actionCell += `<div style="color:#f59e0b; font-size:0.85rem;">â³ Ù„Ù… ÙŠÙØªØ­</div>`;
                                            }
                                        }

                                        // Ø²Ø± Ø§Ù„Ø­Ø°Ù (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡)
                                        if (canDelete) {
                                            actionCell += `<div style="margin-top:5px;">
                                                <button onclick="deleteComplaint('${username}', '${key}')" class="btn btn-danger btn-sm">ğŸ—‘</button>
                                            </div>`;
                                        }

                                        // Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                                        const evidenceBtn = c.evidence ? `<button onclick="showZoomImage('${c.evidence}')" class="btn btn-primary btn-sm">ğŸ“·</button>` : '';
                                        const audioPlayer = c.audioRecord ? `<div style="margin-top:5px;"><audio controls src="${c.audioRecord}" style="height:25px; width:150px;"></audio></div>` : '';
                                        const proofCell = (evidenceBtn || audioPlayer) ? `<div>${evidenceBtn} ${audioPlayer}</div>` : '-';

                                        // Ù„ÙˆÙ† Ø§Ù„ØµÙ
                                        let rowColor = 'rgba(255,255,255,0.02)';
                                        if (!c.acknowledged && !c.seen) rowColor = 'rgba(245, 158, 11, 0.08)';
                                        if (!c.acknowledged && c.seen) rowColor = 'rgba(59, 130, 246, 0.08)';

                                        tbody.innerHTML += `
                                            <tr style="background:${rowColor}; border-bottom:1px solid rgba(255,255,255,0.05);">
                                                <td>${c.date}<br><small style="opacity:0.7">${c.time}</small></td>
                                                <td style="color:var(--primary); font-weight:bold;">${c.title}</td>
                                                <td style="font-size:0.9rem;">${c.details}</td>
                                                <td style="color:#ffd700;">${c.amount > 0 ? c.amount : '-'}</td>
                                                <td>${proofCell}</td>
                                                <td>${c.uploader || c.admin || 'System'}</td>
                                                <td style="text-align:center;">${actionCell}</td>
                                            </tr>
                                        `;
                                    });
                                } else {
                                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px;">Ù†Ø¸ÙŠÙ ğŸŒŸ (Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«)</td></tr>';
                                }
                            }

                            // 3. ØªØ£Ù…ÙŠÙ† Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø£ÙŠØ¶Ø§Ù‹
                            function deleteComplaint(username, key) {
                                // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¨Ùˆ ØªÙ…ÙŠÙ… ÙŠØ±ÙØ¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                                if (currentUser.username === 'abutamim') {
                                    alert("â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰.");
                                    return;
                                }

                                if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ØŸ")) {
                                    logDeletionAction("Ø­Ø°Ù Ù…Ø®Ø§Ù„ÙØ©/Ø´ÙƒÙˆÙ‰", username, "ØªÙ… Ø­Ø°Ù Ù…Ø®Ø§Ù„ÙØ© Ù…Ù† Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ¸Ù");
                                    db.ref('users/' + username + '/complaints/' + key).remove()
                                    .then(() => renderComplaintsHistory(username));
                                }
                            }

                            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
                            function checkProfileNotifications(userData) {
                                const badge = document.getElementById('profileNotificationBadge');
                                const btn = document.getElementById('myProfileBtn');
                                const sound = document.getElementById('complaintSound');

                                if (!userData || !userData.complaints) {
                                    badge.classList.add('hidden');
                                    btn.classList.remove('alert-mode', 'dance-alert');
                                    return;
                                }

                                const unreadCount = Object.values(userData.complaints).filter(c => !c.acknowledged).length;

                                if (unreadCount > 0) {
                                    badge.innerText = unreadCount;
                                    badge.classList.remove('hidden');
                                    badge.style.display = 'flex';

                                    // Ø§Ù„Ø²Ø±Ø§Ø± Ù‡ÙŠØ±Ù‚Øµ ÙˆÙŠÙ†ÙˆØ±
                                    btn.classList.add('dance-alert');

                                    // Ù„Ùˆ ÙÙŠ Ø­Ø§Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø³Ù‡ ÙˆØ§ØµÙ„Ø©
                                    if (unreadCount > lastUnreadCount) {
                                        triggerFunnySurprise(); // Ø´ØºÙ„ Ø§Ù„Ø­ÙÙ„Ø©
                                        if (soundActive) {
                                            sound.play().catch(e => console.log("Sound error"));
                                        }
                                    }
                                } else {
                                    badge.classList.add('hidden');
                                    btn.classList.remove('alert-mode', 'dance-alert');
                                }
                                lastUnreadCount = unreadCount;
                            }

                            // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙÙ„Ø© Ø§Ù„Ù…Ø¶Ø­ÙƒØ©
                            function triggerFunnySurprise() {
                                const messages = [
                                    "Ø£ÙˆÙ…Ø§Ù„ Ø¥ÙŠÙ‡ Ø§Ù„Ù„ÙŠ ÙÙŠ Ù…Ù„ÙÙƒ Ø¯Ù‡ ÙŠØ§ Ø¨Ø·Ù„ØŸ ğŸ˜‚",
                                    "Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨ÙŠÙ…Ø³ÙŠ Ø¹Ù„ÙŠÙƒ Ø¨Ø­Ø§Ø¬Ø© Ø­Ù„ÙˆØ© ÙÙŠ Ø§Ù„Ù…Ù„Ù ğŸ",
                                    "Ø´ÙƒÙ„Ùƒ Ø¹Ù…Ù„Øª Ù…ØµÙŠØ¨Ø©.. Ø±ÙˆØ­ Ø´ÙˆÙ Ù…Ù„ÙÙƒ Ø¨Ø³Ø±Ø¹Ø©! ğŸƒâ€â™‚ï¸",
                                    "ÙÙŠ Ù‡Ø¯ÙŠØ© (Ø£Ùˆ Ø®Ù†Ø§Ù‚Ø©) Ù…Ø³ØªÙ†ÙŠØ§Ùƒ ÙÙŠ Ø§Ù„Ù…Ù„Ù ğŸ‘€",
                                    "ÙŠØ§ Ø¹ÙŠÙ†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙŠ Ø§ØªÙƒØªØ¨ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©! ğŸ“"
                                ];

                                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                                const toast = document.getElementById('funnyToast');
                                document.getElementById('funnyToastText').innerText = messages[Math.floor(Math.random() * messages.length)];
                                toast.classList.add('show');

                                // Ø·ÙŠØ± Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©
                                for(let i=0; i<15; i++) {
                                    setTimeout(() => {
                                        const emoji = document.createElement('div');
                                        emoji.className = 'floating-emoji';
                                        const icons = ['ğŸ', 'ğŸš¨', 'ğŸ“œ', 'ğŸ˜‚', 'ğŸ‘»', 'ğŸ”¥'];
                                        emoji.innerText = icons[Math.floor(Math.random() * icons.length)];
                                        emoji.style.left = Math.random() * 100 + "vw";
                                        emoji.style.animationDuration = (Math.random() * 2 + 2) + "s";
                                        document.body.appendChild(emoji);
                                        setTimeout(() => emoji.remove(), 4000);
                                    }, i * 200);
                                }

                                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                                setTimeout(() => {
                                    toast.classList.remove('show');
                                }, 5000);
                            }
                            
                            // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù (Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©)
                            function logDeletionAction(actionType, targetName, details) {
                                const logData = {
                                    adminName: currentUser.realName || currentUser.username, // Ù…ÙŠÙ† Ø§Ù„Ù„ÙŠ Ù…Ø³Ø­
                                    adminUser: currentUser.username,
                                    action: actionType, // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø­ (Ø­Ø°Ù Ù…ÙˆØ¸ÙØŒ Ø­Ø°Ù Ø´ÙƒÙˆÙ‰..)
                                    target: targetName, // Ø§Ù„Ø¶Ø­ÙŠØ© (Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù„ÙŠ Ø§ØªÙ…Ø³Ø­ Ù„Ù‡ Ø­Ø§Ø¬Ø©)
                                    details: details || "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„",
                                    timestamp: getServerTime(),
                                    dateStr: getServerDateString() + ' ' + getServerTimeString()
                                };

                                // Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù…ÙƒØ§Ù† Ø§Ø³Ù…Ù‡ admin_logs
                                db.ref('admin_logs').push(logData);
                            }

                            let initialServerTime = Date.now(), initialPerformanceTime = performance.now();
                            db.ref(".info/serverTimeOffset").on("value", (snap) => {
                                initialServerTime = Date.now() + (snap.val() || 0);
                                initialPerformanceTime = performance.now();
                            });

                            function getServerTime() { return initialServerTime + (performance.now() - initialPerformanceTime); }
                            function getServerDateString() { const d = new Date(getServerTime()); return `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getFullYear()}`; }
                            function getServerTimeString() { const d = new Date(getServerTime()); let h = d.getHours(); const m = d.getMinutes().toString().padStart(2, '0'), s = d.getSeconds().toString().padStart(2, '0'), ampm = h >= 12 ? 'PM' : 'AM'; h = h % 12 || 12; return `${h.toString().padStart(2, '0')}:${m}:${s} ${ampm}`; }

                            const MANAGERS = ['mahmoud', 'abutamim', 'ahmed', 'admin'];

                            function getDeviceType() {
                                const ua = navigator.userAgent;
                                if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) return "tablet";
                                if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) return "mobile";
                                return "desktop";
                            }

                            const localLoadTime = Date.now();
                            db.ref('refreshSignal').on('value', (snap) => {
                                const signalTime = snap.val();
                                if (signalTime && signalTime > localLoadTime && currentUser && currentUser.role !== 'admin') { location.reload(); }
                            });

                            function triggerGlobalRefresh() { db.ref('refreshSignal').set(getServerTime()); }

                            function activateSystemAndSound() {
                                sessionStorage.setItem('systemActive', 'true');
                                ['alarmSound', 'notifySound', 'requestRing', 'broadcastSound'].forEach(id => {
                                    const s = document.getElementById(id);
                                    s.volume = 0; s.play().then(() => { s.pause(); s.currentTime = 0; s.volume = 1; }).catch(e => console.log(e));
                                });
                                soundActive = true;
                                if ("Notification" in window) Notification.requestPermission();
                                document.getElementById('forceSoundOverlay').style.display = 'none';
                                startGlobalTimer();
                            }

                            function activateAdminSound() {
                                ['alarmSound', 'notifySound', 'requestRing', 'broadcastSound'].forEach(id => {
                                    const s = document.getElementById(id);
                                    s.volume = 0;
                                    s.play().then(() => {
                                        s.pause(); s.currentTime = 0; s.volume = 1;
                                    }).catch(e => console.log(e));
                                });
                                soundActive = true;
                                sessionStorage.setItem('systemActive', 'true');
                                if ("Notification" in window) Notification.requestPermission();
                                alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ”Š");
                            }

                            db.ref('broadcasts').on('value', (snap) => {
                                const data = snap.val() || {}, employeeLog = document.getElementById('employeeBroadcastLog'), adminLog = document.getElementById('adminBroadcastLog');
                                if(employeeLog) employeeLog.innerHTML = ""; if(adminLog) adminLog.innerHTML = "";
                                const keys = Object.keys(data).sort((a, b) => data[b].timestamp - data[a].timestamp);
                                keys.forEach(key => {
                                    const b = data[key], timeStr = new Date(b.timestamp).toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});
                                    if (adminLog) adminLog.innerHTML += `<div style="padding:4px; border-bottom:1px solid rgba(255,255,255,0.1)"><b>[${timeStr}]</b> ${b.message} <button onclick="deleteBroadcast('${key}')" style="background:none; border:none; color:red; cursor:pointer;">ğŸ—‘</button></div>`;
                                    if (employeeLog && currentUser) {
                                        let isForMe = (!b.target || b.target === 'all');
                                        if(!isForMe) {
                                            let targets = Array.isArray(b.target) ? b.target : (typeof b.target === 'object' ? Object.values(b.target) : [b.target]);
                                            if(targets.includes(currentUser.username)) isForMe = true;
                                        }
                                        if(isForMe) employeeLog.innerHTML += `<div class="broadcast-item"><b>[${timeStr}]</b> ${b.message}</div>`;
                                    }
                                });
                                if (keys.length > 0) {
                                    const latestKey = keys[0], b = data[latestKey];
                                    if (latestKey !== lastReceivedBroadcastID) {
                                        lastReceivedBroadcastID = latestKey; localStorage.setItem('last_broadcast_id', latestKey);
                                        if (currentUser && currentUser.role !== 'admin') {
                                            let forMe = (!b.target || b.target === 'all');
                                            if(!forMe) {
                                                let targets = Array.isArray(b.target) ? b.target : (typeof b.target === 'object' ? Object.values(b.target) : [b.target]);
                                                if(targets.includes(currentUser.username)) forMe = true;
                                            }
                                            if(forMe) showBroadcastOverlay(b.message);
                                        }
                                    }
                                }
                            });

                            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø§Ù„Ø© Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙ„Ø§Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                            db.ref('settings/prayerOpen').on('value', (snap) => {
                                isPrayerWindowOpen = snap.val() === true;
                                
                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
                                const statusText = document.getElementById('prayerStatusText');
                                if (statusText) {
                                    statusText.innerText = isPrayerWindowOpen ? "Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ø¢Ù† (ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø©)" : "Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØºÙ„Ù‚Ø© (Ø§Ù„Ø²Ø± Ù…Ø¹Ø·Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†)";
                                    statusText.style.color = isPrayerWindowOpen ? "var(--success)" : "var(--danger)";
                                }

                                // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ¸Ù
                                const prayerBtn = document.querySelector("button[onclick=\"startMyBreak('ØµÙ„Ø§Ø©')\"]");
                                if (prayerBtn && currentUser && currentUser.role !== 'admin') {
                                    if (isPrayerWindowOpen) {
                                        prayerBtn.disabled = false;
                                        prayerBtn.style.opacity = "1";
                                        prayerBtn.style.cursor = "pointer";
                                        prayerBtn.innerText = "Ø§Ø¨Ø¯Ø£";
                                    } else {
                                        prayerBtn.disabled = true;
                                        prayerBtn.style.opacity = "0.5";
                                        prayerBtn.style.cursor = "not-allowed";
                                        prayerBtn.innerText = "Ù…ØºÙ„Ù‚";
                                    }
                                }
                            });

                            function sendBroadcast() {
                                const msg = document.getElementById('broadcastInput').value.trim();
                                const select = document.getElementById('broadcastTarget');
                                let selectedValues = Array.from(select.selectedOptions).map(option => option.value);
                                if (selectedValues.length === 0) selectedValues = ['all'];
                                if (!msg) return alert("Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹");
                                db.ref('broadcasts').push({ message: msg, timestamp: getServerTime(), sender: currentUser.username, target: selectedValues.includes('all') ? 'all' : selectedValues });
                                document.getElementById('broadcastInput').value = "";
                            }

                            function setPrayerWindow(status) {
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØªØ­ ÙˆØ§Ù„ØºÙ„Ù‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª (Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØµØ§Ø±Ø®)
    db.ref('settings/prayerOpen').set(status).then(() => {
        const msg = status ? "ØªÙ… Ø¥ØªØ§Ø­Ø© Ø²Ø± Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† âœ…" : "ØªÙ… Ø­Ø¬Ø¨ Ø²Ø± Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ğŸ›‘";
        alert(msg); // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ù„Ù„ØªØ£ÙƒÙŠØ¯
    });
}

                            function addPrayerTimeGlobal() {
    if(!confirm("Ø¥Ø¶Ø§ÙØ© 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø±ØµÙŠØ¯ ØµÙ„Ø§Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŸ")) return;

    db.ref('users').once('value', (snapshot) => {
        const users = snapshot.val();
        if (!users) return;

        const updates = {};
        const maxLimit = 2700; // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 45 Ø¯Ù‚ÙŠÙ‚Ø©

        Object.keys(users).forEach(key => {
            if (!MANAGERS.includes(key)) {
                let currentLimit = parseInt(users[key].prayerLimit || 0);
                if (currentLimit < maxLimit) {
                    let newLimit = currentLimit + 900; // Ø¥Ø¶Ø§ÙØ© 15 Ø¯Ù‚ÙŠÙ‚Ø©
                    if (newLimit > maxLimit) newLimit = maxLimit;
                    updates[`users/${key}/prayerLimit`] = newLimit;
                }
            }
        });

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø²Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆÙ‚Øª
        updates['settings/prayerOpen'] = true;

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø£Ù† ØªÙƒÙˆÙ† ØµØ§Ù…ØªØ© ØªÙ…Ø§Ù…Ø§Ù‹ Ø§Ø­Ø°Ù Ø§Ù„Ø³Ø·ÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠØ©)
        const bKey = db.ref('broadcasts').push().key;
        updates[`broadcasts/${bKey}`] = {
            message: "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø© (Ø¥Ø¶Ø§ÙØ© 15 Ø¯Ù‚ÙŠÙ‚Ø©) ğŸ•Œ",
            timestamp: getServerTime(),
            sender: currentUser.username,
            target: 'all'
        };

        db.ref().update(updates).then(() => {
            alert("ØªÙ… Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        });
    });
}

                            function deleteBroadcast(key) {
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ØŸ (Ø³ÙŠØ®ØªÙÙŠ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ ÙˆÙ„Ù† ÙŠØµÙ„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†)")) {
        logDeletionAction("Ø­Ø°Ù ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù…", "Ø§Ù„ÙƒÙ„", "ØªÙ… Ø­Ø°Ù Ø±Ø³Ø§Ù„Ø© Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª");
        db.ref('broadcasts/' + key).remove();
    }
}
                            function showBroadcastOverlay(msg) {
                                document.getElementById('broadcastMsgText').innerText = msg;
                                document.getElementById('broadcastOverlay').style.display = 'flex';
                                if (soundActive) document.getElementById('broadcastSound').play().catch(e => {});
                            }
                            function acknowledgeBroadcast() { document.getElementById('broadcastOverlay').style.display = 'none'; const s = document.getElementById('broadcastSound'); s.pause(); s.currentTime = 0; }

                            db.ref('settings/limits').on('value', (snap) => {
                                const limits = snap.val() || { breaks: 3, prayers: 2 };
                                maxBreaksAllowed = limits.breaks; maxPrayersAllowed = limits.prayers;
                                if(document.getElementById('maxBreaksInput')) document.getElementById('maxBreaksInput').value = maxBreaksAllowed;
                                if(document.getElementById('maxPrayersInput')) document.getElementById('maxPrayersInput').value = maxPrayersAllowed;
                            });

                            db.ref('users').on('value', (snap) => {
                                const newData = snap.val() || {};
                                if (currentUser && currentUser.role === 'admin' && isLoaded && soundActive) {
                                    let pending = false;
                                    Object.keys(newData).forEach(un => {
                                        if (MANAGERS.includes(un)) return;
                                        if (newData[un].isOnBreak && (!allUsersData[un] || !allUsersData[un].isOnBreak)) document.getElementById('notifySound').play().catch(e=>{});
                                        if ((newData[un].otRequest && newData[un].otRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') || (newData[un].emRequest && newData[un].emRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') || (newData[un].meetingRequest && newData[un].meetingRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±')) pending = true;
                                    });
                                    const ring = document.getElementById('requestRing');
                                    if (pending) { if (ring.paused) ring.play().catch(e=>{}); } else { ring.pause(); ring.currentTime = 0; }
                                }
                                allUsersData = newData;
                                if (!isLoaded) { isLoaded = true; document.getElementById('loading').style.display = 'none'; document.getElementById('mainContainer').classList.remove('hidden'); checkSavedSession(); }
                                if (currentUser) {
                                    const updatedMe = allUsersData[currentUser.username];
                                    if(updatedMe) { const r = currentUser.role; currentUser = updatedMe; currentUser.role = r; }
                                    if (currentUser.role === 'admin') {
                                        renderMonitorTable(); renderAdminEmRequests(); renderAdminMeetingRequests(); renderAdminOtRequests(); renderUserManagementTable(); updateBroadcastTargets();

                                        if(['mahmoud', 'ahmed'].includes(currentUser.username)) {
                                            document.getElementById('masterDeleteBtn').classList.remove('hidden');
                                            document.getElementById('rangeDeleteBtn').classList.remove('hidden');
                                        } else {
                                            document.getElementById('masterDeleteBtn').classList.add('hidden');
                                            document.getElementById('rangeDeleteBtn').classList.add('hidden');
                                        }

if (currentUser.role === 'admin') {
    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡Ù…
    const superAdmins = ['mahmoud', 'ahmed'];

    if (superAdmins.includes(currentUser.username)) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
        document.getElementById('dangerZone').classList.remove('hidden');

        // ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±Ø§Ø±
        const myName = currentUser.realName || currentUser.username;
        document.getElementById('rangeDeleteBtn').innerHTML = `ğŸ—‘ Ø­Ø°Ù Ø§Ù„ÙØªØ±Ø© (${myName})`;
        document.getElementById('masterDeleteBtn').innerHTML = `ğŸ”¥ ØªØµÙÙŠØ± Ø§Ù„ÙƒÙ„ (${myName})`;
    } else {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ø£ÙŠ Ø­Ø¯ ØªØ§Ù†ÙŠ
        document.getElementById('dangerZone').classList.add('hidden');
    }
}

                                        if(!document.getElementById('tab-reports').classList.contains('hidden')) renderUserReport();
                                    }
                                    else { updateUserUI(); updateEmStatus(); updateMeetingStatus(); updateOtStatus(); checkBreakLimit(); checkProfileNotifications(currentUser); }
                                }
                            });

                            function updateLimits() {
                                const b = parseInt(document.getElementById('maxBreaksInput').value), p = parseInt(document.getElementById('maxPrayersInput').value);
                                db.ref('settings/limits').set({ breaks: b, prayers: p }).then(() => { triggerGlobalRefresh(); alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…"); });
                            }

                            function checkBreakLimit() {
                                if(!currentUser || currentUser.role === 'admin') return;
                                const currentActive = Object.values(allUsersData).filter(u => u.isOnBreak && (u.breakType === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType === 'Ø·ÙˆØ§Ø±Ø¦')).length;
                                const box = document.getElementById('breakLimitAlert');
                                if(currentActive >= maxBreaksAllowed) { 
                                    box.style.display = 'block'; 
                                    box.innerHTML = `ÙŠØ§ Ø¨Ø·Ù„ØŒ Ø²Ù…Ø§ÙŠÙ„Ùƒ ÙƒÙ„Ù‡Ù… ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø¯Ù„ÙˆÙ‚ØªÙŠ. Ø§Ø³ØªÙ†Ù‰ Ø¯Ù‚Ø§ÙŠÙ‚ Ù„Ø­Ø¯ Ù…Ø§ Ø­Ø¯ ÙŠØ±Ø¬Ø¹ Ø¹Ø´Ø§Ù† Ù†ÙØ¶Ù„ Ø´ØºØ§Ù„ÙŠÙ†.. Ø£ÙˆÙ„ Ù…Ø§ Ø­Ø¯ ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù‡ÙŠÙƒÙˆÙ† Ù…ÙØªÙˆØ­ Ù„ÙŠÙƒ! ğŸ’ª`; 
                                } 
                                else box.style.display = 'none';
                            }

                            function checkSavedSession() { const s = localStorage.getItem('break_sys_user'); if (s && allUsersData[s]) { currentUser = allUsersData[s]; currentUser.role = MANAGERS.includes(s) ? 'admin' : 'employee'; if (currentUser.role === 'admin') showAdmin(); else { setupPresence(s); showEmployee(); } } }
                            
                            function attemptLogin() { 
                                const u = document.getElementById('loginUser').value.trim().toLowerCase(), p = document.getElementById('loginPass').value.trim(); 
                                if (allUsersData[u] && allUsersData[u].password === p) { 
                                    currentUser = allUsersData[u]; currentUser.role = MANAGERS.includes(u) ? 'admin' : 'employee'; 
                                    localStorage.setItem('break_sys_user', u); if (currentUser.role === 'admin') showAdmin(); else { setupPresence(u); showEmployee(); } 
                                } else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); 
                            }

                            function setupPresence(un) { 
                                const s = db.ref("users/" + un + "/state"), dRef = db.ref("users/" + un + "/device");
                                db.ref(".info/connected").on("value", snap => { if (snap.val()) { s.onDisconnect().set("offline").then(() => { s.set("online"); dRef.set(getDeviceType()); }); } }); 
                            }

                            function logout() { if(currentUser && currentUser.role !== 'admin') db.ref("users/"+currentUser.username+"/state").set("offline"); localStorage.removeItem('break_sys_user'); sessionStorage.removeItem('systemActive'); location.reload(); }

                            function showAdmin() {
                                document.getElementById('loginSection').classList.add('hidden');
                                document.getElementById('adminSection').classList.remove('hidden');

                                // Ø§Ù„Ù…ÙƒØ§Ù†: Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© showAdmin()
                                const managerNameEl = document.getElementById('currentManagerDisplay');
                                const realName = currentUser.realName || currentUser.username;

                                if (currentUser.username === 'mahmoud') {
                                    // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ù…Ø­Ù…ÙˆØ¯ (ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
                                    managerNameEl.innerHTML = `
                                        <span class="boss-crown">ğŸ‘‘</span>
                                        <span class="the-boss-name">${realName} (CEO)</span>
                                    `;
                                } else {
                                    // Ù„Ùˆ Ø£ÙŠ Ù…Ø´Ø±Ù ØªØ§Ù†ÙŠ (Ø¹Ø§Ø¯ÙŠ)
                                    managerNameEl.innerText = `Ø§Ù„Ù…Ø´Ø±Ù: ${realName}`;
                                    managerNameEl.style.color = ""; // Ø±ÙŠØ³Øª Ù„Ù„Ø£Ù„ÙˆØ§Ù†
                                    managerNameEl.className = "";   // Ø±ÙŠØ³Øª Ù„Ù„ÙƒÙ„Ø§Ø³Ø§Øª
                                }

                                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø±ÙŠ Ù„Ù…Ø­Ù…ÙˆØ¯ ÙÙ‚Ø·
                                if (currentUser.username === 'mahmoud') {
                                    document.getElementById('secretResetBtn').classList.remove('hidden');
                                } else {
                                    document.getElementById('secretResetBtn').classList.add('hidden');
                                }

                                switchAdminTab('monitor');
                                startGlobalTimer();
                            }
                            
                            function showEmployee() { 
                                document.getElementById('loginSection').classList.add('hidden'); document.getElementById('employeeSection').classList.remove('hidden'); 
                                document.getElementById('welcomeMsg').innerText = `Ø£Ù‡Ù„Ø§Ù‹ØŒ ${currentUser.realName || currentUser.username}`; 
                                const pPic = currentUser.profilePic || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                                document.getElementById('userProfilePicDisplay').src = pPic;
                                const titleBox = document.getElementById('userFunTitleDisplay');
                                if(currentUser.funTitle) titleBox.innerHTML = `<div class="fun-title-badge">âœ¨ ${currentUser.funTitle} âœ¨</div>`;
                                else titleBox.innerHTML = "";
                                if (sessionStorage.getItem('systemActive') === 'true') { document.getElementById('forceSoundOverlay').style.display = 'none'; soundActive = true; startGlobalTimer(); } 
                                else { document.getElementById('forceSoundOverlay').style.display = 'flex'; }
                            }

                            // --- Ù†Ø¸Ø§Ù… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ---
                            function updateMyProfilePic() { document.getElementById('selfPicInput').click(); }

                            async function handleFileUpload(input, mode) {
                                if (input.files && input.files[0]) {
                                    const file = input.files[0];
                                    // ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                                    const statusMsg = mode === 'self' ? "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« ØµÙˆØ±ØªÙƒ..." : "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...";
                                    alert(statusMsg);

                                    const downloadURL = await uploadToCloudinary(file);

                                    if (downloadURL) {
                                        if (mode === 'self') {
                                            db.ref('users/' + currentUser.username).update({ profilePic: downloadURL })
                                            .then(() => alert("ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰"));
                                        } else if (mode === 'admin') {
                                            document.getElementById('newProfilePic').value = downloadURL;
                                            alert("ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©.");
                                        }
                                    }
                                }
                            }
                            // ----------------------------

                            function switchAdminTab(t) { ['tab-monitor','tab-reports','tab-users','tab-overtime','tab-emergency','tab-meetings'].forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById('tab-'+t).classList.remove('hidden'); if(t==='reports') updateReportSelect(); }
                            
                        function startGlobalTimer() {
                            if(timerInterval) clearInterval(timerInterval);

                            timerInterval = setInterval(() => {
                                // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ† Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
                                const sT = getServerTimeString();
                                const sD = getServerDateString();

                                // 2. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
                                if(currentUser && currentUser.role === 'admin') {
                                    if(document.getElementById('adminServerTime')) {
                                        document.getElementById('adminServerTime').innerText = sT;
                                        document.getElementById('adminServerDate').innerText = sD;
                                    }
                                    updateMonitorValuesOnly(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
                                }

                                // 3. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ù‡Ù…)
                                if(currentUser) {
                                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø©
                                    const timeEl = document.getElementById('userServerTime');
                                    if(timeEl) timeEl.innerText = sT;

                                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
                                    const dateEl = document.getElementById('userServerDate');
                                    if(dateEl) dateEl.innerText = sD;

                                    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø±ÙŠÙƒ
                                    if(typeof updateUserUI === "function") updateUserUI();
                                }
                            }, 1000);
                        }

                            function renderMonitorTable() {
                                const tbody = document.getElementById('monitorBody'), search = document.getElementById('monitorSearch').value.toLowerCase();
                                tbody.innerHTML = ''; let actB = 0, actP = 0;
                                Object.values(allUsersData).forEach(u => {
                                    if (!u || !u.username || MANAGERS.includes(u.username) || (search && !(u.realName || u.username).toLowerCase().includes(search))) return;
                                    let lg = u.usedSeconds||0, lp = u.prayerSeconds||0, lm = u.meetingSeconds||0, lf = u.followUpSeconds||0, lv = u.vipSeconds||0;
                                    if (u.isOnBreak && u.lastStartTime) {
                                        let elap = Math.floor((getServerTime() - u.lastStartTime) / 1000);
                                        if (u.breakType === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType === 'Ø·ÙˆØ§Ø±Ø¦') { lg += elap; actB++; } else if (u.breakType === 'ØµÙ„Ø§Ø©') { lp += elap; actP++; } else if (u.breakType === 'Ù…ÙŠØªÙ†Ø¬') lm += elap; else if (u.breakType === 'Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') lf += elap; else if (u.breakType === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') lv += elap;
                                    }
                                    const rem = ((u.allowance||45)*60) - lg, online = `<span class="online-dot" style="color:${u.state === 'online' ? '#10b981' : '#64748b'}"></span>`;
                                    const deviceIcon = u.device === 'mobile' ? 'ğŸ“±' : (u.device === 'tablet' ? 'ğŸ“²' : 'ğŸ’»');
                                    const pPic = u.profilePic || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                                    const imgTag = `<img src="${pPic}" class="profile-img">`;
                                    const savedS = adminSelectBuffer[u.username] || 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…';
                                    const statusCell = u.isOnBreak ? `<span style="color:var(--danger); font-weight:bold;">${u.breakType}</span>` : '<span style="color:var(--success);">Ù…ØªØ§Ø­ âœ…</span>';
                                    const ctrl = u.isOnBreak ? `<button onclick="adminStop('${u.username}')" class="btn btn-danger btn-sm">ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù</button> <button onclick="openUserProfile('${u.username}')" class="btn btn-dark btn-sm" title="Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰">ğŸ“‚</button>` : `<div class="admin-table-ctrl"><div class="admin-row-top"><select id="sel_${u.username}" onchange="saveAdminSelect('${u.username}', this.value)"><option value="Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…" ${savedS=='Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…'?'selected':''}>Ø¨Ø±ÙŠÙƒ</option><option value="ØµÙ„Ø§Ø©" ${savedS=='ØµÙ„Ø§Ø©'?'selected':''}>ØµÙ„Ø§Ø©</option><option value="Ù…ÙŠØªÙ†Ø¬" ${savedS=='Ù…ÙŠØªÙ†Ø¬'?'selected':''}>Ù…ÙŠØªÙ†Ø¬</option><option value="Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„" ${savedS=='Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„'?'selected':''}>Ù…ØªØ§Ø¨Ø¹</option><option value="Ø§Ø³ØªØ±Ø§Ø­Ø© VIP" ${savedS=='Ø§Ø³ØªØ±Ø§Ø­Ø© VIP'?'selected':''}>VIP</option></select><button onclick="adminStart('${u.username}')" class="btn btn-success btn-sm">â–¶</button><button onclick="openUserProfile('${u.username}')" class="btn btn-dark btn-sm" title="Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰">ğŸ“‚</button></div><input type="text" id="inp_${u.username}" placeholder="Ø§Ù„Ø³Ø¨Ø¨..." oninput="saveAdminTyping('${u.username}', this.value)"></div>`;
                                    tbody.innerHTML += `<tr class="${u.isOnBreak && u.breakType==='Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' && rem < 300 && rem > 0?'ÙˆØ¶Ø¹-Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡':''}">
                                        <td style="text-align:right;">${imgTag} ${u.realName || u.username} ${online} ${deviceIcon} ${u.isVIP ? 'â­' : ''}</td>
                                        <td>${statusCell}<br><small>${u.lastReason || ''}</small></td>
                                        <td><span id="rem_${u.username}">${rem>=0?formatTime(rem):'<span style="color:var(--danger)">-'+formatTime(Math.abs(rem))+'</span>'}</span></td>
                                        <td><span id="pray_${u.username}">${formatTime(lp)}</span><br><small>Ù…ØªØ¨Ø¹: <span id="follow_${u.username}">${formatTime(lf)}</span></small></td>
                                        <td><span id="meet_${u.username}">${formatTime(lm)}</span><br><small>VIP: <span id="vip_${u.username}">${formatTime(lv)}</span></small></td>
                                        <td>${ctrl}</td></tr>`;
                                });
                                document.getElementById('statusCountersDisplay').innerText = `ğŸ” Ø¨Ø±ÙŠÙƒ: (${actB}/${maxBreaksAllowed}) | ğŸ•Œ ØµÙ„Ø§Ø©: (${actP}/${maxPrayersAllowed})`;
                            }

                            function updateMonitorValuesOnly() {
                                Object.values(allUsersData).forEach(u => {
                                    if (!u || !u.username || MANAGERS.includes(u.username)) return;
                                    let lg = u.usedSeconds||0, lp = u.prayerSeconds||0, lm = u.meetingSeconds||0, lf = u.followUpSeconds||0, lv = u.vipSeconds||0;
                                    if (u.isOnBreak && u.lastStartTime) {
                                        let elap = Math.floor((getServerTime() - u.lastStartTime) / 1000);
                                        if (u.breakType === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType === 'Ø·ÙˆØ§Ø±Ø¦') lg += elap; else if (u.breakType === 'ØµÙ„Ø§Ø©') lp += elap; else if (u.breakType === 'Ù…ÙŠØªÙ†Ø¬') lm += elap; else if (u.breakType === 'Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') lf += elap; else if (u.breakType === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') lv += elap;
                                    }
                                    const rem = ((u.allowance||45)*60) - lg;
                                    const rEl = document.getElementById(`rem_${u.username}`); if(rEl) rEl.innerHTML = rem>=0?formatTime(rem):`<span style="color:var(--danger); font-weight:bold;">-${formatTime(Math.abs(rem))}</span>`;
                                    const pEl = document.getElementById(`pray_${u.username}`); if(pEl) pEl.innerText = formatTime(lp);
                                    const mEl = document.getElementById(`meet_${u.username}`); if(mEl) mEl.innerText = formatTime(lm);
                                    const fEl = document.getElementById(`follow_${u.username}`); if(fEl) fEl.innerText = formatTime(lf);
                                    const vEl = document.getElementById(`vip_${u.username}`); if(vEl) vEl.innerText = formatTime(lv);
                                });
                            }

                            function renderUserReport() {
                                const un = document.getElementById('reportUserSelect').value; if(!un) return;
                                const u = allUsersData[un], sB = document.getElementById('sessionsReportBody'), mS = document.getElementById('monthlySummary'), start = document.getElementById('filterStartDate').value, end = document.getElementById('filterEndDate').value;
                                sB.innerHTML = ''; mS.classList.remove('hidden');
                                let tOx=0, tPr=0, tFo=0, tVi=0; const allowS = (u.allowance||45)*60;
                                if (u.sessions) {
                                    const grouped = {};
                                    Object.keys(u.sessions).forEach(k => {
                                        const s = u.sessions[k], cD = s.date.split('/').reverse().join('-');
                                        if ((start && cD < start) || (end && cD > end)) return;
                                        if(!grouped[s.date]) grouped[s.date] = { acts: [], total: 0, prayer: 0, follow: 0, vip: 0 };
                                        const dur = parseInt(s.duration) || 0;
                                        let deleteBtnHTML = ""; if(['mahmoud', 'ahmed'].includes(currentUser.username)) deleteBtnHTML = `<button onclick="deleteSpecificSession('${un}', '${k}')" style="background:var(--danger); border:none; color:white; border-radius:5px; padding:2px 6px; cursor:pointer; font-size:0.7rem; margin-right:5px;">Ø­Ø°Ù</button>`;
                                        grouped[s.date].acts.push(`<div style="font-size:0.75rem; display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; background:rgba(255,255,255,0.02); padding:3px; border-radius:4px;"><span>${s.type}: ${Math.round(dur/60)}Ø¯ (${s.reason||'--'})</span>${deleteBtnHTML}</div>`);
                                        if(s.type === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || s.type === 'Ø·ÙˆØ§Ø±Ø¦') grouped[s.date].total += dur;
                                        else if(s.type === 'ØµÙ„Ø§Ø©') grouped[s.date].prayer += dur; else if(s.type === 'Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') grouped[s.date].follow += dur; else if(s.type === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') grouped[s.date].vip += dur;
                                    });
                                    Object.keys(grouped).sort((a,b)=>b.localeCompare(a)).forEach(d => {
                                        const ox = Math.max(0, grouped[d].total - allowS); tOx += ox; tPr += grouped[d].prayer; tFo += grouped[d].follow; tVi += grouped[d].vip;
                                        sB.innerHTML += `<tr><td>${d}</td><td>${grouped[d].acts.join('')}</td><td>${Math.round(grouped[d].total/60)}Ø¯</td><td style="color:${ox>0? 'var(--danger)':'var(--success)'}">${Math.round(ox/60)}Ø¯</td></tr>`;
                                    });
                                }
                                document.getElementById('monthTotalBreaks').innerText = Math.round(tOx/60) + " Ø¯";
                                document.getElementById('monthTotalPrayer').innerText = Math.round(tPr/60) + " Ø¯";
                                document.getElementById('monthTotalFollowUp').innerText = Math.round(tFo/60) + " Ø¯";
                                document.getElementById('monthTotalVIP').innerText = Math.round(tVi/60) + " Ø¯";
                            }

                            function deleteSpecificSession(un, key) { if(!['mahmoud', 'ahmed'].includes(currentUser.username)) return; if(confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ØŸ")) db.ref(`users/${un}/sessions/${key}`).remove().then(() => renderUserReport()); }

                            window.adminStart = (un) => { 
                                const type = adminSelectBuffer[un] || 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…', r = adminTypingBuffer[un] || 'Ø¨Ø¯Ø¡ Ø¥Ø¯Ø§Ø±ÙŠ';
                                db.ref('users/'+un).update({ isOnBreak: true, breakType: type, lastStartTime: getServerTime(), lastReason: r }).then(() => triggerGlobalRefresh()); 
                            };
                            window.adminStop = (un) => { 
                                const u = allUsersData[un], d = Math.floor((getServerTime() - u.lastStartTime)/1000); 
                                db.ref('users/'+un+'/sessions').push({ date: getServerDateString(), type: u.breakType, reason: u.lastReason || 'Ø¥ÙŠÙ‚Ø§Ù Ø¥Ø¯Ø§Ø±ÙŠ', duration: d }); 
                                const up = { isOnBreak: false, lastStartTime: null, lastEndedTime: getServerTime(), lastEndedType: u.breakType }; 
                                if(u.breakType==='Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType==='Ø·ÙˆØ§Ø±Ø¦') { up.usedSeconds = (u.usedSeconds||0)+d; if(u.breakType==='Ø·ÙˆØ§Ø±Ø¦') up.emRequest = null; } 
                                else if(u.breakType==='ØµÙ„Ø§Ø©') up.prayerSeconds = (u.prayerSeconds||0)+d; 
                                else if(u.breakType==='Ù…ÙŠØªÙ†Ø¬') { up.meetingSeconds = (u.meetingSeconds||0)+d; up.meetingRequest = null; }
                                else if(u.breakType==='Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') up.followUpSeconds = (u.followUpSeconds||0)+d; 
                                else if(u.breakType==='Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') up.vipSeconds = (u.vipSeconds||0)+d;
                                db.ref('users/'+un).update(up).then(() => triggerGlobalRefresh()); 
                            };

                            function startMyBreak(t) {
                                if(currentUser.isOnBreak) return;

                                db.ref('users').get().then((snapshot) => {
                                    const latestUsers = snapshot.val() || {};
                                    const myData = latestUsers[currentUser.username];

                                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø²Ø­Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¹Ø§Ù…
                                    const currentActiveBreaks = Object.values(latestUsers).filter(u => u.isOnBreak && (u.breakType === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType === 'Ø·ÙˆØ§Ø±Ø¦')).length;

                                    // ---[ Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ ]---
                                    if (t === 'ØµÙ„Ø§Ø©') {
                                        // 1. Ù‡Ù„ Ø§Ù„ØµÙ„Ø§Ø© Ù…ÙØªÙˆØ­Ø©ØŸ
                                        if (!isPrayerWindowOpen) {
                                            alert("ğŸ›‘ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø´Ø±Ù.");
                                            return;
                                        }

                                        // 2. Ù‡Ù„ Ø¹Ù†Ø¯Ù‡ Ø±ØµÙŠØ¯ØŸ
                                        const limit = myData.prayerLimit || 0; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù„ÙŠ Ø§Ù„Ù…Ø´Ø±Ù Ù†Ø²Ù„Ù‡
                                        const used = myData.prayerSeconds || 0; // Ø§Ù„Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‡Ù„ÙƒÙ‡

                                        // Ø§Ù„Ø´Ø±Ø·: Ù„Ùˆ Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„Ø±ØµÙŠØ¯
                                        if (used >= limit) {
                                            // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯ÙŠ Ù‡ØªÙˆØ¶Ø­Ù„Ùƒ Ø§Ù„Ø³Ø¨Ø¨ Ø¨Ø§Ù„Ø¸Ø¨Ø·
                                            alert(`âš ï¸ Ø±ØµÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù†ØªÙ‡Ù‰!\n\nØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${Math.floor(used/60)} Ø¯Ù‚ÙŠÙ‚Ø©\nØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ: ${Math.floor(limit/60)} Ø¯Ù‚ÙŠÙ‚Ø©\n\nØ§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø´Ø±Ù ÙŠØ²ÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª.`);
                                            return;
                                        }
                                    }
                                    // -----------------------------

                                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø²Ø­Ù…Ø© Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¹Ø§Ù…
                                    if ((t === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || t === 'Ø·ÙˆØ§Ø±Ø¦' || t === 'Ù…ÙŠØªÙ†Ø¬' || t === 'Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') && currentActiveBreaks >= maxBreaksAllowed) {
                                        return alert(`Ø§Ù„Ø¹Ø¯Ø¯ Ù…ÙƒØªÙ…Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠÙƒØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹..`);
                                    }

                                    let r = document.getElementById('breakReason').value.trim();
                                    if(t === 'ØµÙ„Ø§Ø©') r = "ØµÙ„Ø§Ø©";

                                    db.ref('users/'+currentUser.username).update({
                                        isOnBreak: true,
                                        breakType: t,
                                        lastStartTime: getServerTime(),
                                        lastReason: r || t
                                    });
                                });
                            }

                            function stopMyBreak() {
                                const u = currentUser, d = Math.floor((getServerTime() - u.lastStartTime)/1000);
                                db.ref('users/'+u.username+'/sessions').push({ date: getServerDateString(), type: u.breakType, reason: u.lastReason, duration: d });
                                const up = { isOnBreak: false, lastStartTime: null, lastEndedTime: getServerTime(), lastEndedType: u.breakType };
                                if(u.breakType==='Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType==='Ø·ÙˆØ§Ø±Ø¦') { up.usedSeconds = (u.usedSeconds||0)+d; if(u.breakType === 'Ø·ÙˆØ§Ø±Ø¦') up.emRequest = null; }
                                else if(u.breakType==='ØµÙ„Ø§Ø©') {
                                    up.prayerSeconds = (u.prayerSeconds||0)+d;
                                    // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±Ø§Øª
                                    up.prayerCountToday = (u.prayerCountToday || 0) + 1;
                                }
                                // Ø¨Ù‚ÙŠØ© Ø§Ù„Ø£Ù†ÙˆØ§Ø¹...
                                else if(u.breakType==='Ù…ÙŠØªÙ†Ø¬') { up.meetingSeconds = (u.meetingSeconds||0)+d; up.meetingRequest = null; }
                                else if(u.breakType==='Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„') up.followUpSeconds = (u.followUpSeconds||0)+d;
                                else if(u.breakType==='Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') up.vipSeconds = (u.vipSeconds||0)+d;
                                db.ref('users/'+u.username).update(up); document.getElementById('breakReason').value = "";
                            }

                            function updateUserUI() {
                                if(!currentUser || currentUser.role === 'admin') return;
                                const u = currentUser;
                                const timerText = document.getElementById('userTimer');
                                const lbl = document.getElementById('timerLabel');
                                const msg = document.getElementById('userStatusMsg');
                                const circle = document.getElementById('timerCircle');
                                const welcomeArea = document.getElementById('welcomeBackArea');
                                const circ = 628;
                                const allowTotal = (u.allowance || 45) * 60;

                                // --- Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ¸Ù (VIP / CS) ---

                                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± VIP Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆØ¸Ù VIP
                                const vipArea = document.getElementById('vipControlArea');
                                if (u.isVIP) vipArea.classList.remove('hidden');
                                else vipArea.classList.add('hidden');

                                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ©
                                const followArea = document.getElementById('followUpCard');
                                if (u.canFollowUp) followArea.classList.remove('hidden');
                                else followArea.classList.add('hidden');

                                // Ù…Ù†Ø·Ù‚ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (CS Agent)
                                const csDashboard = document.getElementById('csAgentDashboard');
                                const normalControls = document.getElementById('controlsArea');
                                const stopArea = document.getElementById('stopArea');

                                if (u.isCS) {
                                    // Ù„Ùˆ Ø§Ù„Ù…ÙˆØ¸Ù Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ (CS)
                                    if (!u.isOnBreak) {
                                        // ÙˆÙ‡Ùˆ Ø´ØºØ§Ù„ (Ù…Ø´ ÙÙŠ Ø¨Ø±ÙŠÙƒ):
                                        // 1. Ø§Ø¸Ù‡Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©
                                        csDashboard.classList.remove('hidden');

                                        // 2. Ø§Ø¸Ù‡Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Ø¯Ù‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„ÙŠ Ø§Ù†Øª Ù…Ø­ØªØ§Ø¬Ù‡) âœ…
                                        normalControls.classList.remove('hidden');

                                        // 3. Ø§Ø®ÙÙŠ Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„ÙƒØ¨ÙŠØ±
                                        stopArea.classList.add('hidden');

                                        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                                        populateCsEmployeeList();
                                    } else {
                                        // ÙˆÙ‡Ùˆ ÙÙŠ Ø¨Ø±ÙŠÙƒ:
                                        // Ø§Ø®ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠÙƒ
                                        csDashboard.classList.add('hidden');
                                        normalControls.classList.add('hidden');

                                        // Ø§Ø¸Ù‡Ø± Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙŠÙƒ
                                        stopArea.classList.remove('hidden');
                                    }
                                } else {
                                    // ... (Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ Ù…Ø§ØªØºÙŠØ±ÙˆØ´) ...
                                    csDashboard.classList.add('hidden');
                                    if (u.isOnBreak) {
                                        normalControls.classList.add('hidden');
                                        stopArea.classList.remove('hidden');
                                    } else {
                                        normalControls.classList.remove('hidden');
                                        stopArea.classList.add('hidden');
                                    }
                                }

                                // --- Ø«Ø§Ù†ÙŠØ§Ù‹: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„ÙˆÙ‚Øª ---
                                if (u.isOnBreak) {
                                    welcomeArea.innerHTML = "";
                                    msg.innerText = "Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ: " + u.breakType;
                                    const elap = Math.floor((getServerTime() - u.lastStartTime) / 1000);

                                    // Ù„Ùˆ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø­Ø§Ù„Ø© ØµÙ„Ø§Ø©
                                    if (u.breakType === 'ØµÙ„Ø§Ø©') {
                                        const limit = u.prayerLimit || 0; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­
                                        const usedPre = u.prayerSeconds || 0; // Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ù‚Ø¯ÙŠÙ…Ø§Ù‹
                                        const current = elap; // Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ø§Ù„Ø¢Ù†

                                        // Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ = Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ - (Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ù‚Ø¯ÙŠÙ…Ø§Ù‹ + Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ø§Ù„Ø¢Ù†)
                                        const remaining = limit - (usedPre + current);

                                        if (remaining > 0) {
                                            timerText.innerText = formatTime(remaining);
                                            lbl.innerText = "Ø±ØµÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ";
                                            timerText.style.color = "#38bdf8"; // Ø£Ø²Ø±Ù‚
                                            circle.style.stroke = "#38bdf8";

                                            // Ø±Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© (Ù†Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¹Ù„Ù‰ 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø´ÙƒÙ„)
                                            let pct = (remaining / 900);
                                            circle.style.strokeDashoffset = circ - (pct * circ);
                                        } else {
                                            // Ø§Ù„Ø±ØµÙŠØ¯ Ø®Ù„Øµ
                                            timerText.innerText = "00:00";
                                            // ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨Ø±ÙŠÙƒ (Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ Ø¶ÙÙ†Ø§Ù‡Ø§ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡)
                                            autoConvertPrayerToBreak();
                                        }
                                    }
                                    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¹Ø§Ù… (Ø§Ù„Ø£ÙƒØ³Ø¯Ø©) ---
                                    else if (u.breakType === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || u.breakType === 'Ø·ÙˆØ§Ø±Ø¦' || u.breakType === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') {
                                        const rem = allowTotal - ((u.usedSeconds || 0) + (u.breakType === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP' ? 0 : elap));

                                        let pct = (rem / allowTotal); if (pct < 0) pct = 0;
                                        circle.style.strokeDashoffset = circ - (pct * circ);

                                        if (u.breakType === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') {
                                            timerText.innerText = formatTime(elap);
                                            lbl.innerText = "Ù…Ø¯Ø© Ø§Ù„Ù€ VIP";
                                            circle.style.stroke = "#ffd700"; // Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ
                                        } else if (rem >= 0) {
                                            lbl.innerText = "Ø±ØµÙŠØ¯ Ù…ØªØ¨Ù‚ÙŠ";
                                            timerText.innerText = formatTime(rem);
                                            timerText.style.color = "white";
                                            circle.style.stroke = "#10b981";
                                            stopAlarm();
                                        } else {
                                            lbl.innerText = "Ø£ÙƒØ³Ø¯Ø©";
                                            timerText.innerText = "-" + formatTime(Math.abs(rem));
                                            timerText.style.color = "#ef4444";
                                            circle.style.stroke = "#ef4444";
                                            playAlarm();
                                        }
                                    }
                                    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ (Ù…ÙŠØªÙ†Ø¬ØŒ Ù…ØªØ§Ø¨Ø¹Ø©...)
                                    else {
                                        timerText.innerText = formatTime(elap);
                                        lbl.innerText = "Ù…Ø¯Ø© " + u.breakType;
                                        circle.style.stroke = "#f59e0b";
                                        circle.style.strokeDashoffset = 0;
                                    }
                                } else {
                                    stopAlarm();
                                    const rem = allowTotal - (u.usedSeconds || 0);
                                    timerText.innerText = rem >= 0 ? formatTime(rem) : "00:00";
                                    timerText.style.color = "white";
                                    lbl.innerText = "Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠÙƒ";
                                    msg.innerText = "Ù…ØªØ§Ø­ Ù„Ù„Ø¹Ù…Ù„ âœ…";
                                    let pct = (rem / allowTotal); if (pct < 0) pct = 0;
                                    circle.style.strokeDashoffset = circ - (pct * circ);
                                    circle.style.stroke = "var(--primary)";

                                    if (u.lastEndedTime && (Math.floor((getServerTime() - u.lastEndedTime) / 1000) < 300)) {
                                        const userTitle = u.funTitle || 'ÙŠØ§ Ø¨Ø·Ù„';
                                        let customMsg = "";

                                        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù„ÙŠ Ù„Ø³Ù‡ Ø®Ù„ØµØ§Ù†
                                        switch (u.lastEndedType) {
                                            case 'ØµÙ„Ø§Ø©':
                                                customMsg = `ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ ÙŠØ§ ${userTitle} ğŸ•Œ Ø§Ù„Ø­Ø±Ù… Ø¥Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡`;
                                                break;
                                            case 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…':
                                                customMsg = `Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙŠØ§ ${userTitle} ğŸ” Ù†ÙˆØ±Øª Ù…ÙƒØªØ¨Ùƒ`;
                                                break;
                                            case 'Ù…ÙŠØªÙ†Ø¬':
                                                customMsg = `ÙƒÙØ§Ø±Ø© ÙŠØ§ ${userTitle}! Ù…Ø§Ø¨ØºÙŠØª ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ù…ÙŠØªÙ†Ø¬ØŸ ğŸ¤ğŸ˜‚`;
                                                break;
                                            case 'Ø·ÙˆØ§Ø±Ø¦':
                                                customMsg = `Ù„Ø¹Ù„Ù‡ Ø®ÙŠØ± ÙŠØ§ ${userTitle}.. Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ØªÙƒ ğŸš¨`;
                                                break;
                                            case 'Ù…ØªØ§Ø¨Ø¹ Ø¹Ù…ÙŠÙ„':
                                                customMsg = `Ø¹Ø§Ø´ ÙŠØ§ ÙˆØ­Ø´ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.. Ù†ÙˆØ±ØªÙ†Ø§ ØªØ§Ù†ÙŠ ğŸ“`;
                                                break;
                                            default:
                                                customMsg = `Ù†ÙˆØ±Øª Ù…ÙƒØ§Ù†Ùƒ ÙŠØ§ ${userTitle} Ù…Ù† Ø¬Ø¯ÙŠØ¯ â¤ï¸`;
                                        }

                                        welcomeArea.innerHTML = `<div class="welcome-back-msg" style="animation: bounceIn 0.8s ease;">${customMsg}</div>`;
                                    } else welcomeArea.innerHTML = "";
                                }
                            }

                            function formatTime(s) { if(isNaN(s) || s < 0) return "00:00"; return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
                            function playAlarm() { if(soundActive) { document.body.classList.add('ÙˆØ¶Ø¹-Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡'); document.getElementById('overtimeAlert').classList.remove('hidden'); document.getElementById('alarmSound').play().catch(e=>{}); } }
                            function stopAlarm() { document.body.classList.remove('ÙˆØ¶Ø¹-Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡'); if(document.getElementById('overtimeAlert')) document.getElementById('overtimeAlert').classList.add('hidden'); document.getElementById('alarmSound').pause(); }
                            function saveAdminTyping(u, v) { adminTypingBuffer[u] = v; }
                            function saveAdminSelect(u, v) { adminSelectBuffer[u] = v; }
                            function updateReportSelect() { const sel = document.getElementById('reportUserSelect'); sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…ÙˆØ¸Ù --</option>'; Object.values(allUsersData).forEach(u => { if(u.username && !MANAGERS.includes(u.username)) sel.innerHTML += `<option value="${u.username}">${u.realName || u.username}</option>`; }); }
                            function updateBroadcastTargets() {
                                const sel = document.getElementById('broadcastTarget'); const old = Array.from(sel.selectedOptions).map(o => o.value);
                                let h = '<option value="all">ğŸ“£ Ù„Ù„Ø¬Ù…ÙŠØ¹</option>';
                                Object.values(allUsersData).forEach(u => { if(u.username && !MANAGERS.includes(u.username)) h += `<option value="${u.username}">ğŸ‘¤ ${u.realName || u.username}</option>`; });
                                if (sel.innerHTML !== h) { sel.innerHTML = h; old.forEach(v => { const o = sel.querySelector(`option[value="${v}"]`); if(o) o.selected = true; }); }
                            }

                            function sendEmRequest() { const r = document.getElementById('breakReason').value.trim(); if(!r) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨"); db.ref('users/'+currentUser.username+'/emRequest').set({ reason: r, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', timestamp: getServerTime() }); }
                            
                            function updateEmStatus() { 
                                const el = document.getElementById('emStatusArea'); 
                                if(!currentUser.emRequest) {
                                    el.innerHTML = `<button onclick="sendEmRequest()" class="btn btn-danger" style="width:100%">Ø·Ù„Ø¨</button>`;
                                    return;
                                }
                                if(currentUser.emRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') {
                                    el.innerHTML = `<span style="color:orange;">â³...</span>`;
                                } else if(currentUser.emRequest.status === 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„') {
                                    el.innerHTML = `<button onclick="startMyBreak('Ø·ÙˆØ§Ø±Ø¦')" class="btn btn-success btn-sm" style="width:100%">Ø§Ø¨Ø¯Ø£</button>`;
                                } else {
                                    el.innerHTML = `<span style="color:red; font-weight:bold;">âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶</span>`;
                                    setTimeout(() => {
                                        if(currentUser.emRequest && (currentUser.emRequest.status === 'Ø±ÙÙØ¶' || currentUser.emRequest.status.includes('Ø±ÙØ¶'))) {
                                            db.ref('users/'+currentUser.username+'/emRequest').remove();
                                        }
                                    }, 4000);
                                }
                            }

                            function renderAdminEmRequests() { const tb = document.getElementById('adminEmBody'); tb.innerHTML = ''; let c = 0; Object.values(allUsersData).forEach(u => { if(u.emRequest && u.emRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') { c++; tb.innerHTML += `<tr><td>${u.realName}</td><td>${u.emRequest.reason}</td><td>${new Date(u.emRequest.timestamp).toLocaleTimeString()}</td><td><button onclick="handleEm('${u.username}', true)" class="btn btn-success btn-sm">âœ”</button><button onclick="handleEm('${u.username}', false)" class="btn btn-danger btn-sm">âœ–</button></td></tr>`; } }); document.getElementById('emBadge').innerText = c; c > 0 ? document.getElementById('emBadge').classList.remove('hidden') : document.getElementById('emBadge').classList.add('hidden'); }
                            window.handleEm = (un, app) => { if(app) db.ref('users/'+un).update({ isOnBreak: true, breakType: 'Ø·ÙˆØ§Ø±Ø¦', lastStartTime: getServerTime(), lastReason: allUsersData[un].emRequest.reason, 'emRequest/status': 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„' }); else db.ref(`users/${un}/emRequest`).update({ status: 'Ø±ÙÙØ¶' }); triggerGlobalRefresh(); };
                            
                            function sendMeetingRequest() { const r = document.getElementById('breakReason').value.trim(); if(!r) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨"); db.ref('users/'+currentUser.username+'/meetingRequest').set({ reason: r, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', timestamp: getServerTime() }); }
                            
                            function updateMeetingStatus() { 
                                const el = document.getElementById('meetingStatusArea'); 
                                if(!currentUser.meetingRequest) {
                                    el.innerHTML = `<button onclick="sendMeetingRequest()" class="btn btn-warning" style="width:100%">Ø·Ù„Ø¨</button>`;
                                    return;
                                }
                                if(currentUser.meetingRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') {
                                    el.innerHTML = `<span style="color:orange;">â³...</span>`;
                                } else if(currentUser.meetingRequest.status === 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„') {
                                    el.innerHTML = `<button onclick="startMyBreak('Ù…ÙŠØªÙ†Ø¬')" class="btn btn-success btn-sm" style="width:100%">Ø§Ø¨Ø¯Ø£</button>`;
                                } else {
                                    el.innerHTML = `<span style="color:red; font-weight:bold;">âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶</span>`;
                                    setTimeout(() => {
                                        if(currentUser.meetingRequest && (currentUser.meetingRequest.status === 'Ø±ÙÙØ¶' || currentUser.meetingRequest.status.includes('Ø±ÙØ¶'))) {
                                            db.ref('users/'+currentUser.username+'/meetingRequest').remove();
                                        }
                                    }, 4000);
                                }
                            }

                            function renderAdminMeetingRequests() { const tb = document.getElementById('adminMeetBody'); tb.innerHTML = ''; let c = 0; Object.values(allUsersData).forEach(u => { if(u.meetingRequest && u.meetingRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') { c++; tb.innerHTML += `<tr><td>${u.realName}</td><td>${u.meetingRequest.reason}</td><td>${new Date(u.meetingRequest.timestamp).toLocaleTimeString()}</td><td><button onclick="handleMeeting('${u.username}', true)" class="btn btn-success btn-sm">âœ”</button><button onclick="handleMeeting('${u.username}', false)" class="btn btn-danger btn-sm">âœ–</button></td></tr>`; } }); document.getElementById('meetBadge').innerText = c; c > 0 ? document.getElementById('meetBadge').classList.remove('hidden') : document.getElementById('meetBadge').classList.add('hidden'); }
                            window.handleMeeting = (un, app) => { if(app) db.ref('users/'+un).update({ isOnBreak: true, breakType: 'Ù…ÙŠØªÙ†Ø¬', lastStartTime: getServerTime(), lastReason: allUsersData[un].meetingRequest.reason, 'meetingRequest/status': 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„' }); else db.ref(`users/${un}/meetingRequest`).update({ status: 'Ø±ÙÙØ¶' }); triggerGlobalRefresh(); };
                            
                            function sendOtRequest() { const h = document.getElementById('otHoursInput').value; if(!h) return; db.ref('users/'+currentUser.username+'/otRequest').set({ hours: h, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', timestamp: getServerTime() }); }
                            
                            function updateOtStatus() { 
                                const el = document.getElementById('otStatusDisplay'); 
                                if(!currentUser.otRequest) {
                                    el.innerText = "";
                                    return;
                                }
                                if (currentUser.otRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') {
                                    el.innerText = "â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
                                } else if (currentUser.otRequest.status === 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„') {
                                    el.innerText = "âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„";
                                } else {
                                    el.innerText = "âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶";
                                    setTimeout(() => {
                                        if(currentUser.otRequest && (currentUser.otRequest.status === 'Ø±ÙÙØ¶' || currentUser.otRequest.status.includes('Ø±ÙØ¶'))) {
                                            db.ref('users/'+currentUser.username+'/otRequest').remove();
                                        }
                                    }, 4000);
                                }
                            }

                            function renderAdminOtRequests() { const tb = document.getElementById('adminOtBody'); tb.innerHTML = ''; let c=0; Object.values(allUsersData).forEach(u => { if(u.otRequest && u.otRequest.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±') { c++; tb.innerHTML += `<tr><td>${u.realName}</td><td>${u.otRequest.hours}Ø³</td><td>${new Date(u.otRequest.timestamp).toLocaleTimeString()}</td><td><button onclick="handleOt('${u.username}', true)" class="btn btn-success btn-sm">âœ”</button><button onclick="handleOt('${u.username}', false)" class="btn btn-danger btn-sm">âœ–</button></td></tr>`; } }); document.getElementById('otBadge').innerText = c; c > 0 ? document.getElementById('otBadge').classList.remove('hidden') : document.getElementById('otBadge').classList.add('hidden'); }
                            window.handleOt = (un, app) => { if(app) db.ref(`users/${un}/overtimeHistory/${getServerTime()}`).set({ date: getServerDateString(), hours: allUsersData[un].otRequest.hours, approvedBy: currentUser.username }); db.ref(`users/${un}/otRequest`).update({ status: app ? 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„' : 'Ø±ÙÙØ¶' }).then(() => triggerGlobalRefresh()); };
                            function endDay() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´Ø±Ù (Ø£ÙŠ Ù…Ø´Ø±Ù ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
    if (!MANAGERS.includes(currentUser.username)) {
        alert("â›” Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ù‡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙÙ‚Ø·.");
        return;
    }

    if(confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŸ")) {
        logDeletionAction("ØªØµÙÙŠØ± Ø§Ù„ÙŠÙˆÙ… (End Day)", "Ø§Ù„ÙƒÙ„", "Ù‚Ø§Ù… Ø§Ù„Ù…Ø´Ø±Ù Ø¨ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†");
        Object.keys(allUsersData).forEach(un => {
            if(!MANAGERS.includes(un)) {
                db.ref('users/'+un).update({
                    // ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
                    usedSeconds: 0,
                    prayerSeconds: 0,
                    meetingSeconds: 0,
                    followUpSeconds: 0,
                    vipSeconds: 0,
                    prayerLimit: 0,
                    isOnBreak: false,
                    lastStartTime: null,
                    // Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
                    otRequest: null,
                    emRequest: null,
                    meetingRequest: null
                });
            }
        });
        triggerGlobalRefresh(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹
        alert("ØªÙ… ØªÙ‚ÙÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ø¬Ø§Ø­ Ø¨ÙˆØ§Ø³Ø·Ø©: " + (currentUser.realName || currentUser.username));
    }
}
                            function forceResetPrayerOnly() {
                                if(!confirm("ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© ÙÙ‚Ø· Ù„Ù„Ø¬Ù…ÙŠØ¹ (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)ØŸ")) return;

                                db.ref('users').once('value', snapshot => {
                                    const users = snapshot.val();
                                    const updates = {};
                                    Object.keys(users).forEach(key => {
                                        updates[`users/${key}/prayerLimit`] = 0;   // ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯
                                        updates[`users/${key}/prayerSeconds`] = 0; // ØªØµÙÙŠØ± Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ
                                        updates[`users/${key}/prayerCountToday`] = 0;
                                    });
                                    db.ref().update(updates).then(() => alert("ØªÙ… ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©. Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø¢Ù†."));
                                });
                            }
                            function deleteAllReports() { if(!['mahmoud', 'ahmed'].includes(currentUser.username)) return; if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ")) { Object.keys(allUsersData).forEach(u => { db.ref(`users/${u}/sessions`).remove(); db.ref(`users/${u}/overtimeHistory`).remove(); }); triggerGlobalRefresh(); } }
                            function deleteReportsInRange() {
                                if(!['mahmoud', 'ahmed'].includes(currentUser.username)) return;
                                const un = document.getElementById('reportUserSelect').value, start = document.getElementById('filterStartDate').value, end = document.getElementById('filterEndDate').value;
                                if (!start || !end) return alert("Ø­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ®");
                                if (!confirm("Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ")) return;
                                const targets = un ? [un] : Object.keys(allUsersData).filter(k => !MANAGERS.includes(k));
                                targets.forEach(userKey => {
                                    const u = allUsersData[userKey];
                                    if (u.sessions) Object.keys(u.sessions).forEach(k => { const parts = u.sessions[k].date.split('/'); const iso = `${parts[2]}-${parts[1]}-${parts[0]}`; if (iso >= start && iso <= end) db.ref(`users/${userKey}/sessions/${k}`).remove(); });
                                });
                                alert("ØªÙ… Ø§Ù„Ø­Ø°Ù"); triggerGlobalRefresh();
                            }

                            function renderUserManagementTable() {
                                const tb = document.getElementById('usersManagementBody');
                                if(!tb) return;
                                tb.innerHTML = '';

                                // 1. ØªØ­Ø¯ÙŠØ¯ Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ Ù…Ø­Ù…ÙˆØ¯ Ø£Ù… Ù„Ø§
                                const isSuperAdmin = ['mahmoud', 'ahmed'].includes(currentUser.username);
                                const isMahmoud = (currentUser.username === 'mahmoud');

                                // 2. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ± Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†)
                                const headerPass = document.getElementById('headerUserPass');
                                const headerFileLock = document.getElementById('headerFilePass');

                                if (headerPass && headerFileLock) {
                                    if (isMahmoud) {
                                        headerPass.style.display = 'table-cell';
                                        headerFileLock.style.display = 'table-cell';
                                    } else {
                                        headerPass.style.display = 'none';
                                        headerFileLock.style.display = 'none';
                                    }
                                }

                                // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                                Object.values(allUsersData).forEach(u => {
                                    if(!u || !u.username || MANAGERS.includes(u.username)) return;

                                    // ØªØ¬Ù‡ÙŠØ² Ø®Ù„ÙŠØ© Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù
                                    let filePassDisplay = '';
                                    if (isMahmoud) {
                                        filePassDisplay = u.filePassword ?
                                            `<span style="color:var(--accent); font-weight:bold;">${u.filePassword}</span>` :
                                            `<span style="color:#666; font-size:0.7rem;">ØºÙŠØ± Ù…Ø¹ÙŠÙ†</span>`;
                                    }

                                    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø´Ø±Ø·ÙŠØ© (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù…Ø­Ù…ÙˆØ¯)
                                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­Ù…ÙˆØ¯: Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø®Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…ÙˆØ¯: Ù†Ø¹Ø±Ø¶ Ù†Øµ ÙØ§Ø±Øº '' Ø­ØªÙ‰ Ù„Ø§ ÙŠØªÙ… Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙŠØ© ÙˆØªØ®Ø±Ø¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                                    const passCell = isMahmoud ? `<td>${u.password}</td>` : '';
                                    const lockCell = isMahmoud ? `<td style="font-family:monospace;">${filePassDisplay}</td>` : '';

                                    // Ø§Ù„Ù„Ù‚Ø¨
                                    const funTitle = u.funTitle ? `<span style="color:#ffd700">${u.funTitle}</span>` : '---';

                                    tb.innerHTML += `
                                    <tr>
                                        <td>${u.realName || u.username}</td>
                                        <td>${u.username}</td>

                                        ${passCell}  <!-- Ø®Ù„ÙŠØ© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ -->
                                        ${lockCell}  <!-- Ø®Ù„ÙŠØ© Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù -->

                                        <td>${u.allowance}Ø¯</td>
                                        <td>${funTitle}</td>
                                        <td>
                                            <button onclick="openUserProfile('${u.username}')" class="btn btn-dark btn-sm" title="Ø§Ù„Ù…Ù„Ù">ğŸ“‚</button>
                                            <button onclick="editUser('${u.username}')" class="btn btn-warning btn-sm">âœ</button>
                                            <button onclick="deleteUser('${u.username}')" class="btn btn-danger btn-sm">ğŸ—‘</button>
                                        </td>
                                    </tr>`;
                                });
                            }

                            window.saveUser = () => {
                                const un = document.getElementById('newUsername').value.trim().toLowerCase(), pass = document.getElementById('newPassword').value, name = document.getElementById('newRealName').value, allow = parseInt(document.getElementById('newAllowance').value), isVIP = document.getElementById('isVIPUser').checked, follow = document.getElementById('canFollowUp').checked;
                                const funTitle = document.getElementById('newFunTitle').value.trim();
                                const profilePic = document.getElementById('newProfilePic').value.trim();
                                const isCS = document.getElementById('isCSAgent').checked; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                                if(!un || !pass || !name) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                                const data = { realName: name, password: pass, allowance: allow, isVIP: isVIP, canFollowUp: follow, isCS: isCS, funTitle: funTitle, profilePic: profilePic };
                                if (editingUserKey) db.ref('users/' + editingUserKey).update(data).then(() => { triggerGlobalRefresh(); alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"); resetUserForm(); });
                                else db.ref('users/' + un).set({...data, username: un, role: 'employee', usedSeconds: 0, prayerSeconds: 0, meetingSeconds: 0, followUpSeconds: 0, vipSeconds: 0, isOnBreak: false}).then(() => { triggerGlobalRefresh(); alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©"); resetUserForm(); });
                            };
                            
                            window.editUser = (un) => {
                                const u = allUsersData[un]; editingUserKey = un;
                                document.getElementById('newUsername').value = u.username; document.getElementById('newUsername').disabled = true;
                                document.getElementById('newRealName').value = u.realName; document.getElementById('newPassword').value = u.password;
                                document.getElementById('newAllowance').value = u.allowance; document.getElementById('newFunTitle').value = u.funTitle || '';
                                document.getElementById('newProfilePic').value = u.profilePic || '';
                                document.getElementById('isVIPUser').checked = !!u.isVIP; document.getElementById('canFollowUp').checked = !!u.canFollowUp;
                                document.getElementById('isCSAgent').checked = !!u.isCS;
                            };
                            
                            function resetUserForm() { editingUserKey = null; document.getElementById('newUsername').disabled = false; document.getElementById('newUsername').value = ''; document.getElementById('newRealName').value = ''; document.getElementById('newPassword').value = ''; document.getElementById('newAllowance').value = '45'; document.getElementById('newFunTitle').value = ''; document.getElementById('newProfilePic').value = ''; }
                            function deleteUser(un) {
                                if(confirm("Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸ÙØŸ")) {
                                    logDeletionAction("Ø­Ø°Ù Ù…ÙˆØ¸Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„", un, "ØªÙ… Ù…Ø³Ø­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ³ØªÙ…");
                                    db.ref('users/'+un).remove().then(() => triggerGlobalRefresh());
                                }
                            }

                            function openUserProfile(username) {
                                const u = allUsersData[username];
                                if(!u) return;

                                const isAdmin = MANAGERS.includes(currentUser.username);
                                const isOwner = (currentUser.username === username);

                                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆØ¸Ù Ù‡Ùˆ Ù…Ù† ÙŠÙØªØ­ Ù…Ù„ÙÙ‡
                                if (!isAdmin && isOwner) {
                                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¨Ø¹Ø¯
                                    if (!u.filePassword) {
                                        alert("ğŸ”’ Ù„Ù… ØªÙ‚Ù… Ø¨ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ø®ØµÙˆØµÙŠØ© Ù…Ù„ÙÙƒ Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ Ø§Ù„Ø¢Ù†.");
                                        openFilePassModal(true);
                                        return;
                                    }

                                    // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† promptØŒ Ù†ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¢Ù…Ù†Ø©
                                    pendingProfileUser = username;
                                    document.getElementById('accessFilePassInput').value = ''; // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚Ù„
                                    document.getElementById('accessFileModal').classList.remove('hidden');
                                    document.getElementById('accessFilePassInput').focus();
                                    return;
                                }

                                // Ù„Ùˆ Ø£Ø¯Ù…Ù†ØŒ ÙŠÙØªØ­ Ø¹Ù„Ø·ÙˆÙ„
                                loadProfileData(username);
                            }

                            // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                            function confirmAccessFile() {
                                const inputPass = document.getElementById('accessFilePassInput').value;
                                const u = allUsersData[pendingProfileUser];

                                if (inputPass === u.filePassword) {
                                    document.getElementById('accessFileModal').classList.add('hidden');
                                    loadProfileData(pendingProfileUser); // ÙØªØ­ Ø§Ù„Ù…Ù„Ù
                                } else {
                                    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
                                    document.getElementById('accessFilePassInput').value = '';
                                }
                            }

                            function closeAccessModal() {
                                document.getElementById('accessFileModal').classList.add('hidden');
                                pendingProfileUser = null;
                            }

                            // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙØµÙ„Ù†Ø§Ù‡Ø§ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡)
                            function loadProfileData(username) {
                                currentProfileTarget = username;
                                const u = allUsersData[username];
                                const isAdmin = MANAGERS.includes(currentUser.username);

                                document.getElementById('profileModal').classList.remove('hidden');
                                document.getElementById('modalRealName').innerText = u.realName || username;
                                document.getElementById('modalUserName').innerText = `@${u.username}`;
                                document.getElementById('modalProfilePic').src = u.profilePic || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';

                                if (isAdmin) {
                                    document.getElementById('adminAddComplaintArea').classList.remove('hidden');
                                } else {
                                    document.getElementById('adminAddComplaintArea').classList.add('hidden');
                                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
                                    if (u.complaints) {
                                        Object.keys(u.complaints).forEach(key => {
                                            if (!u.complaints[key].seen && !u.complaints[key].acknowledged) {
                                                db.ref(`users/${username}/complaints/${key}`).update({ seen: true });
                                            }
                                        });
                                    }
                                }

                                // ØªØµÙÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
                                clearHistoryFilters(false);
                                renderComplaintsHistory(username);
                            }

                            // Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ±
                            function clearHistoryFilters(reload = true) {
                                document.getElementById('historyDateFrom').value = '';
                                document.getElementById('historyDateTo').value = '';
                                if(reload && currentProfileTarget) renderComplaintsHistory(currentProfileTarget);
                            }

                            function closeProfileModal() {
                                document.getElementById('profileModal').classList.add('hidden');
                                currentProfileTarget = null;
                                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                                document.getElementById('complaintTitle').value = '';
                                document.getElementById('deductionAmount').value = '';
                                document.getElementById('complaintDetails').value = '';

                                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙˆØ±
                                document.getElementById('complaintEvidence').value = '';
                                document.getElementById('evidencePreview').style.display = 'none';
                                document.getElementById('evidencePreview').src = '';
                                document.getElementById('evidenceFileName').innerText = '';

                                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙˆØª
                                document.getElementById('complaintAudioInput').value = '';
                                document.getElementById('audioPreviewPlayer').style.display = 'none';
                                document.getElementById('audioPreviewPlayer').src = '';
                                document.getElementById('audioPreviewPlayer').pause(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                                document.getElementById('audioFileName').innerText = '';
                            }

                            // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© ØµÙˆØ±Ø© Ø§Ù„Ø¯Ù„ÙŠÙ„ (Preview & Base64)
                            function previewEvidence(input) {
                                if (input.files && input.files[0]) {
                                    const file = input.files[0];

                                    // 1. ÙØ­Øµ Ø§Ù„Ø­Ø¬Ù… ÙÙˆØ±Ø§Ù‹ (Ø£Ù‚ØµÙ‰ Ø­Ø¯ 5 Ù…ÙŠØ¬Ø§)
                                    if (file.size > 5 * 1024 * 1024) {
                                        alert("Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! (Ø£ÙƒØ¨Ø± Ù…Ù† 5 Ù…ÙŠØ¬Ø§). Ø§Ø®ØªØ± Ù…Ù„Ù Ø£ØµØºØ±.");
                                        input.value = ""; // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                                        return;
                                    }

                                    document.getElementById('evidenceFileName').innerText = file.name;

                                    // 2. Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø¨Ø¯ÙˆÙ† ØªÙ‡Ù†ÙŠØ¬)
                                    const img = document.getElementById('evidencePreview');
                                    img.src = URL.createObjectURL(file); // Ø³Ø­Ø± Ø§Ù„Ø³Ø±Ø¹Ø© Ù‡Ù†Ø§
                                    img.style.display = 'block';

                                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ù…Ø§ Ø§Ù„ØµÙˆØ±Ø© ØªØ­Ù…Ù„
                                    img.onload = () => URL.revokeObjectURL(img.src);
                                }
                            }

                            // 2.1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØª (Preview & Base64)
                            function previewAudio(input) {
                                if (input.files && input.files[0]) {
                                    const file = input.files[0];

                                    // 1. ÙØ­Øµ Ø§Ù„Ø­Ø¬Ù…
                                    if (file.size > 10 * 1024 * 1024) { // 10 Ù…ÙŠØ¬Ø§ Ù„Ù„ØµÙˆØª
                                        alert("Ù…Ù„Ù Ø§Ù„ØµÙˆØª ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ØµØºØ±.");
                                        input.value = "";
                                        return;
                                    }

                                    document.getElementById('audioFileName').innerText = "ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: " + file.name;

                                    // 2. Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
                                    const audioPlayer = document.getElementById('audioPreviewPlayer');
                                    audioPlayer.src = URL.createObjectURL(file); // Ø³Ø­Ø± Ø§Ù„Ø³Ø±Ø¹Ø© Ù‡Ù†Ø§
                                    audioPlayer.style.display = 'block';
                                }
                            }

                            // ==========================================
                            // 2. Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø´ÙƒÙˆÙ‰ (Ø¨Ø®Ø§ØµÙŠØ© Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚)
                            // ==========================================
                            async function submitComplaint() {
                                if (!currentProfileTarget) return;

                                // Ø¨Ù†Ù…Ø³Ùƒ Ø§Ù„Ø²Ø±Ø§Ø± Ø¹Ø´Ø§Ù† Ù†ØªØ­ÙƒÙ… ÙÙŠÙ‡
                                const submitBtn = document.querySelector('#adminAddComplaintArea button.btn-danger');
                                const originalBtnText = submitBtn ? submitBtn.innerText : "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©";

                                const title = document.getElementById('complaintTitle').value.trim();
                                const amount = document.getElementById('deductionAmount').value;
                                const details = document.getElementById('complaintDetails').value;
                                const imgFile = document.getElementById('complaintEvidence').files[0];
                                const audioFile = document.getElementById('complaintAudioInput').files[0];

                                if (!title) return alert("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø£ÙˆÙ„!");

                                // ---[ Ù‡Ù†Ø§ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ]---
                                if(submitBtn) {
                                    submitBtn.disabled = true; // Ø¨Ù†Ù‚ÙÙ„ Ø§Ù„Ø²Ø±Ø§Ø± Ø®Ø§Ù„Øµ
                                    submitBtn.style.opacity = "0.5"; // Ø¨Ù†Ø®ÙÙ Ù„ÙˆÙ†Ù‡
                                    submitBtn.innerHTML = "â³ Ù„Ø­Ø¸Ø©.. Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª..."; // Ø¨Ù†Ø·Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                                }

                                try {
                                    // Ø§Ù„Ø±ÙØ¹ Ø¨ÙŠØ­ØµÙ„ Ù‡Ù†Ø§ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                                    let imageUrl = "";
                                    let audioUrl = "";

                                    if (imgFile) imageUrl = await uploadToCloudinary(imgFile);
                                    if (audioFile) audioUrl = await uploadToCloudinary(audioFile);

                                    // Ø¨Ø¹Ø¯ Ù…Ø§ Ø§Ù„Ù…Ù„ÙØ§Øª ØªØªØ±ÙØ¹ØŒ Ø¨Ù†Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ†Øµ Ø®ÙÙŠÙ
                                    if(submitBtn) submitBtn.innerHTML = "ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

                                    const complaintData = {
                                        date: getServerDateString(),
                                        time: getServerTimeString(),
                                        title: title,
                                        amount: amount || 0,
                                        details: details || "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„",
                                        evidence: imageUrl,    // Ø±Ø§Ø¨Ø· Ø®ÙÙŠÙ
                                        audioRecord: audioUrl, // Ø±Ø§Ø¨Ø· Ø®ÙÙŠÙ
                                        admin: currentUser.realName || currentUser.username,
                                        acknowledged: false
                                    };

                                    await db.ref('users/' + currentProfileTarget + '/complaints').push(complaintData);

                                    alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ØªÙ…Ø§Ù…! ğŸš€");
                                    closeProfileModal();
                                    triggerGlobalRefresh();

                                } catch (e) {
                                    console.error(e);
                                    alert("Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø© ØµØºÙŠØ±Ø©ØŒ Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ.");
                                } finally {
                                    // Ø¨Ù†Ø±Ø¬Ø¹ Ø§Ù„Ø²Ø±Ø§Ø± ÙŠØ´ØªØºÙ„ ØªØ§Ù†ÙŠ ÙÙŠ Ø§Ù„Ø¢Ø®Ø±
                                    if(submitBtn) {
                                        submitBtn.disabled = false;
                                        submitBtn.innerHTML = originalBtnText;
                                        submitBtn.style.opacity = "1";
                                    }
                                }
                            }

                            function renderComplaintsHistory(username) {
                                const tbody = document.getElementById('complaintsHistoryBody');
                                tbody.innerHTML = '';

                                if (!allUsersData[username]) return;

                                const u = allUsersData[username];
                                const viewingMyOwnProfile = (currentUser.username === username);
                                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø°Ù (Ø£Ø¯Ù…Ù† ÙˆÙ„ÙŠØ³ Ø£Ø¨Ùˆ ØªÙ…ÙŠÙ…ØŒ Ø£Ùˆ ÙŠÙƒÙˆÙ† Ù…Ø­Ù…ÙˆØ¯ Ø£Ùˆ Ø£Ø­Ù…Ø¯)
                                const canDelete = (currentUser.role === 'admin' && currentUser.username !== 'abutamim') || ['mahmoud', 'ahmed'].includes(currentUser.username);

                                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
                                const filterFrom = document.getElementById('historyDateFrom').value;
                                const filterTo = document.getElementById('historyDateTo').value;

                                if (u.complaints) {
                                    const keys = Object.keys(u.complaints).reverse();

                                    keys.forEach(key => {
                                        const c = u.complaints[key];

                                        // Ù…Ù†Ø·Ù‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
                                        if (filterFrom || filterTo) {
                                            // ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´ÙƒÙˆÙ‰ Ù…Ù† DD/MM/YYYY Ø¥Ù„Ù‰ YYYY-MM-DD Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                                            const parts = c.date.split('/');
                                            const cDateISO = `${parts[2]}-${parts[1]}-${parts[0]}`;

                                            if (filterFrom && cDateISO < filterFrom) return; // ØªØ®Ø·ÙŠ
                                            if (filterTo && cDateISO > filterTo) return; // ØªØ®Ø·ÙŠ
                                        }

                                        let actionCell = '';

                                        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª
                                        if (c.acknowledged) {
                                            actionCell += `<div style="color:#10b981; font-weight:bold; font-size:0.9rem;">âœ” ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>`;
                                        } else if (c.seen) {
                                            if (currentUser.role === 'admin') {
                                                actionCell += `<div style="color:#3b82f6; font-size:0.85rem;">ğŸ‘ï¸ Ø´Ø§Ù‡Ø¯Ù‡Ø§</div>`;
                                            } else if (viewingMyOwnProfile) {
                                                actionCell += `<button onclick="acknowledgeComplaint('${key}')" class="btn btn-vip btn-sm" style="animation: pulse 2s infinite;">âœ Ù…ÙˆØ§ÙÙ‚</button>`;
                                            }
                                        } else {
                                            if (currentUser.role === 'admin') {
                                                actionCell += `<div style="color:#f59e0b; font-size:0.85rem;">â³ Ù„Ù… ÙŠÙØªØ­</div>`;
                                            }
                                        }

                                        // Ø²Ø± Ø§Ù„Ø­Ø°Ù (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡)
                                        if (canDelete) {
                                            actionCell += `<div style="margin-top:5px;">
                                                <button onclick="deleteComplaint('${username}', '${key}')" class="btn btn-danger btn-sm">ğŸ—‘</button>
                                            </div>`;
                                        }

                                        // Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                                        const evidenceBtn = c.evidence ? `<button onclick="showZoomImage('${c.evidence}')" class="btn btn-primary btn-sm">ğŸ“·</button>` : '';
                                        const audioPlayer = c.audioRecord ? `<div style="margin-top:5px;"><audio controls src="${c.audioRecord}" style="height:25px; width:150px;"></audio></div>` : '';
                                        const proofCell = (evidenceBtn || audioPlayer) ? `<div>${evidenceBtn} ${audioPlayer}</div>` : '-';

                                        // Ù„ÙˆÙ† Ø§Ù„ØµÙ
                                        let rowColor = 'rgba(255,255,255,0.02)';
                                        if (!c.acknowledged && !c.seen) rowColor = 'rgba(245, 158, 11, 0.08)';
                                        if (!c.acknowledged && c.seen) rowColor = 'rgba(59, 130, 246, 0.08)';

                                        tbody.innerHTML += `
                                            <tr style="background:${rowColor}; border-bottom:1px solid rgba(255,255,255,0.05);">
                                                <td>${c.date}<br><small style="opacity:0.7">${c.time}</small></td>
                                                <td style="color:var(--primary); font-weight:bold;">${c.title}</td>
                                                <td style="font-size:0.9rem;">${c.details}</td>
                                                <td style="color:#ffd700;">${c.amount > 0 ? c.amount : '-'}</td>
                                                <td>${proofCell}</td>
                                                <td>${c.uploader || c.admin || 'System'}</td>
                                                <td style="text-align:center;">${actionCell}</td>
                                            </tr>
                                        `;
                                    });
                                } else {
                                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px;">Ù†Ø¸ÙŠÙ ğŸŒŸ (Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«)</td></tr>';
                                }
                            }

                            function deleteComplaint(username, key) {
                                // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¨Ùˆ ØªÙ…ÙŠÙ… ÙŠØ±ÙØ¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                                if (currentUser.username === 'abutamim') {
                                    alert("â›” Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰.");
                                    return;
                                }

                                if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ØŸ")) {
                                    db.ref('users/' + username + '/complaints/' + key).remove()
                                    .then(() => renderComplaintsHistory(username));
                                }
                            }

                            function acknowledgeComplaint(key) {
                                const username = currentProfileTarget;
                                db.ref('users/' + username + '/complaints/' + key).update({ acknowledged: true })
                                .then(() => {
                                    renderComplaintsHistory(username);
                                    checkProfileNotifications(allUsersData[username]);
                                });
                            }

                            function showZoomImage(src) {
                                document.getElementById('zoomedImg').src = src;
                                document.getElementById('imgZoomModal').classList.remove('hidden');
                            }

                            // 5. Ø²Ø± Ù„Ù„Ù…ÙˆØ¸Ù Ù„ÙŠÙØªØ­ Ù…Ù„ÙÙ‡ Ø¨Ù†ÙØ³Ù‡
                            function openMyProfile() {
                                openUserProfile(currentUser.username);
                            }

                            // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
                            function openPassModal() {
                                document.getElementById('changePassModal').classList.remove('hidden');
                            }

                            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                            function closePassModal() {
                                document.getElementById('changePassModal').classList.add('hidden');
                                document.getElementById('oldPassInput').value = '';
                                document.getElementById('newPassInput').value = '';
                                document.getElementById('confirmPassInput').value = '';
                            }

                            // ØªÙ†ÙÙŠØ° ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                            function submitChangePassword() {
                                const oldPass = document.getElementById('oldPassInput').value;
                                const newPass = document.getElementById('newPassInput').value;
                                const confirmPass = document.getElementById('confirmPassInput').value;

                                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
                                if (!oldPass || !newPass || !confirmPass) {
                                    alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
                                    return;
                                }

                                // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ)
                                if (oldPass !== currentUser.password) {
                                    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
                                    return;
                                }

                                // 3. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                                if (newPass !== confirmPass) {
                                    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!");
                                    return;
                                }

                                // 4. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø·ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                                if (newPass.length < 4) {
                                    alert("âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø­Ø±ÙˆÙ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
                                    return;
                                }

                                // 5. Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                db.ref('users/' + currentUser.username).update({
                                    password: newPass
                                }).then(() => {
                                    alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.");
                                    logout(); // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ù…Ø§Ù†
                                }).catch((error) => {
                                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message);
                                });
                            }

                            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ù„Ù
                            function openFilePassModal(isFirstTime = false) {
                                document.getElementById('filePassModal').classList.remove('hidden');
                                const oldArea = document.getElementById('oldFilePassArea');
                                const title = document.getElementById('filePassTitle');
                                
                                if (isFirstTime || !currentUser.filePassword) {
                                    oldArea.classList.add('hidden');
                                    title.innerText = "ğŸ”’ Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙÙ„ Ù„Ù„Ù…Ù„Ù";
                                } else {
                                    oldArea.classList.remove('hidden');
                                    title.innerText = "ğŸ”„ ØªØºÙŠÙŠØ± Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù";
                                }
                            }

                            function closeFilePassModal() {
                                document.getElementById('filePassModal').classList.add('hidden');
                                document.getElementById('oldFilePassInput').value = '';
                                document.getElementById('newFilePassInput').value = '';
                                document.getElementById('confirmFilePassInput').value = '';
                            }

                            // Ø­ÙØ¸ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ù„Ù ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
    function saveFilePassword() {
        const oldPass = document.getElementById('oldFilePassInput').value;
        const newPass = document.getElementById('newFilePassInput').value;
        const confirmPass = document.getElementById('confirmFilePassInput').value;

        // Ù„Ùˆ Ø¹Ù†Ø¯Ù‡ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù‚Ø¯ÙŠÙ… Ù„Ø§Ø²Ù… ÙŠØªØ£ÙƒØ¯ Ù…Ù†Ù‡
        if (currentUser.filePassword && oldPass !== currentUser.filePassword) {
            alert("âŒ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
            return;
        }

        if (!newPass || newPass.length < 2) {
            alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± ØµØ§Ù„Ø­Ø©");
            return;
        }

        if (newPass !== confirmPass) {
            alert("âŒ Ø§Ù„ÙƒÙ„Ù…ØªØ§Ù† ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†");
            return;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ filePassword ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        db.ref('users/' + currentUser.username).update({
            filePassword: newPass
        }).then(() => {
            alert("âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù‚ÙÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ÙØªØ­Ù‡.");
            closeFilePassModal();
        });
    }

    // Ø¯ÙˆØ§Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØª (Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹)
    function previewCsAudio(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];

            // ÙØ­Øµ Ø§Ù„Ø­Ø¬Ù… (5 Ù…ÙŠØ¬Ø§)
            if (file.size > 5 * 1024 * 1024) {
                alert("Ù…Ù„Ù Ø§Ù„ØµÙˆØª ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø£Ø®Ø±Ù‡ 5 Ù…ÙŠØ¬Ø§.");
                input.value = "";
                return;
            }
            // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø§Ù„Ø±Ø§Ù…Ø§Øª
            document.getElementById('csAudioName').innerText = "âœ… " + file.name;
        }
    }

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© (Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹)
    function previewCsImage(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];

            // ÙØ­Øµ Ø§Ù„Ø­Ø¬Ù…
            if (file.size > 5 * 1024 * 1024) {
                alert("Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹!");
                input.value = "";
                return;
            }

            document.getElementById('csImageName').innerText = "âœ… " + file.name;

            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ø­Ø±ÙŠ (URL.createObjectURL)
            const img = document.getElementById('csImagePreview');
            img.src = URL.createObjectURL(file);
            img.style.display = 'block';

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            img.onload = () => URL.revokeObjectURL(img.src);
        }
    }

    async function uploadCsCall() {
        const targetUser = document.getElementById('csTargetUser').value; // Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
        const title = document.getElementById('csCallTitle').value.trim();
        const note = document.getElementById('csCallNote').value.trim();

        const audioFile = document.getElementById('csAudioInput').files[0];
        const imageFile = document.getElementById('csImageInput').files[0];

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!targetUser) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹! âš ï¸");
        if (!title) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…ÙƒØ§Ù„Ù…Ø©");
        if (!audioFile && !imageFile) return alert("ÙŠØ¬Ø¨ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù ØµÙˆØª Ø£Ùˆ ØµÙˆØ±Ø© ÙƒØ¯Ù„ÙŠÙ„!");

        // ---[ 1. Ù‚ÙÙ„ Ø§Ù„Ø²Ø±Ø§Ø± ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ ]---
        // Ø¨Ù†Ø­Ø¯Ø¯ Ø§Ù„Ø²Ø±Ø§Ø± Ø§Ù„Ù„ÙŠ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù€ CS
        const submitBtn = document.querySelector('#csAgentDashboard button.btn-primary');
        const originalText = submitBtn ? submitBtn.innerText : "Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù";

        if(submitBtn) {
            submitBtn.disabled = true; // Ù‚ÙÙ„ Ø§Ù„Ø²Ø±Ø§Ø±
            submitBtn.style.opacity = "0.6";
            submitBtn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª..."; // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·Ù…Ø£Ù†Ø©
        }

        try {
            // ---[ 2. Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹ (ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©) ]---
            let audioUrl = "";
            let imageUrl = "";

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„Ù†Ø§Ù‡Ø§ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
            if (audioFile) audioUrl = await uploadToCloudinary(audioFile);
            if (imageFile) imageUrl = await uploadToCloudinary(imageFile);

            // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­ÙØ¸
            if(submitBtn) submitBtn.innerHTML = "ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

            const recordData = {
                date: getServerDateString(),
                time: getServerTimeString(),
                title: title,
                details: note || "ØªÙ‚ÙŠÙŠÙ… Ø¬ÙˆØ¯Ø©",
                audioRecord: audioUrl,
                evidence: imageUrl,
                type: "Quality Review",
                uploader: currentUser.realName || currentUser.username,
                acknowledged: false
            };

            // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
            await db.ref('users/' + targetUser + '/complaints').push(recordData);

            alert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø³Ø±Ø¹Ø© ØªÙ…Ø§Ù…! ğŸš€`);

            // ---[ 3. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ]---
            document.getElementById('csCallTitle').value = "";
            document.getElementById('csCallNote').value = "";
            document.getElementById('csAudioInput').value = "";
            document.getElementById('csImageInput').value = "";
            document.getElementById('csAudioName').innerText = "";
            document.getElementById('csImageName').innerText = "";
            document.getElementById('csImagePreview').style.display = 'none';
            document.getElementById('csImagePreview').src = "";

        } catch (e) {
            console.error(e);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Øª.");
        } finally {
            // ---[ 4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø²Ø±Ø§Ø± ]---
            if(submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                submitBtn.style.opacity = "1";
            }
        }
    }

    // 1. Ø¯Ø§Ù„Ø© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
    // Ø¯Ø§Ù„Ø© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† Ø§Ù„ØºÙ„Ù‚ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±)
    function populateCsEmployeeList() {
        const select = document.getElementById('csTargetUser');
        if (!select) return;

        // Ù‡Ø§Ù…: Ù„Ùˆ Ø§Ù„Ù…ÙˆØ¸Ù ÙØ§ØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ¨ÙŠØ®ØªØ§Ø±ØŒ Ù†ÙˆÙ‚Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ø´Ø§Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…ØªÙ‚ÙÙ„Ø´ ÙÙŠ ÙˆØ´Ù‡
        if (document.activeElement === select) return;

        const currentVal = select.value;
        let newHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
        let hasChanges = false;

        Object.values(allUsersData).forEach(u => {
            // Ù†Ø³ØªØ¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙˆÙ†Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙ‚Ø·
            if (u.username && !MANAGERS.includes(u.username)) {
                newHTML += `<option value="${u.username}">ğŸ‘¤ ${u.realName || u.username}</option>`;
            }
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§ØªØºÙŠØ± (Ø¹Ø´Ø§Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡)
        if (select.innerHTML !== newHTML) {
            select.innerHTML = newHTML;
            if (currentVal) select.value = currentVal;
        }
    }

    async function archiveOldComplaints() {
        if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„ØªÙŠ Ù…Ø± Ø¹Ù„ÙŠÙ‡Ø§ Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹.")) return;

        const archiveRef = db.ref('archive/complaints');
        const usersRef = db.ref('users');
        let count = 0;

        // 1. Ù†Ø¬ÙŠØ¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const snapshot = await usersRef.once('value');
        const users = snapshot.val();

        if (!users) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!");

        // 2. Ù†Ù„Ù Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…
        for (const [userId, userData] of Object.entries(users)) {
            if (userData.complaints) {
                for (const [compKey, compData] of Object.entries(userData.complaints)) {

                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® (DD/MM/YYYY)
                    const parts = compData.date.split('/');
                    const compDate = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
                    const diffTime = Math.abs(new Date() - compDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    // Ù„Ùˆ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø¹Ø¯Ù‰ Ø¹Ù„ÙŠÙ‡Ø§ 30 ÙŠÙˆÙ…
                    if (diffDays > 30) {
                        // Ø§Ù†Ø³Ø®Ù‡Ø§ Ù„Ù„Ø£Ø±Ø´ÙŠÙ
                        await archiveRef.child(userId).child(compKey).set(compData);
                        // Ø§Ù…Ø³Ø­Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø´Ø·
                        await usersRef.child(userId + '/complaints/' + compKey).remove();
                        count++;
                    }
                }
            }
        }

        alert(`ØªÙ…Øª Ø£Ø±Ø´ÙØ© ${count} Ø´ÙƒÙˆÙ‰ Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸš€\nØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¢Ù† Ø³ÙŠÙƒÙˆÙ† Ø£Ø³Ø±Ø¹.`);
        triggerGlobalRefresh();
    }

    function exportMonthlyExcel() {
        const startDateVal = document.getElementById('filterStartDate').value;
        const endDateVal = document.getElementById('filterEndDate').value;

        if (!startDateVal || !endDateVal) {
            return alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ğŸ“…");
        }

        let reportData = [];

        Object.values(allUsersData).forEach(u => {
            if (!u.username || MANAGERS.includes(u.username)) return;

            let totalBreakTime = 0;
            let totalPrayerTime = 0;
            let totalMeetingTime = 0;
            let totalVIPTime = 0; // Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø§Ù„Ù€ VIP
            let totalOvertimeHours = 0; // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
            let complaintsCount = 0;
            let totalDeductions = 0;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (Ø£ÙƒØ³Ø¯Ø©ØŒ ØµÙ„Ø§Ø©ØŒ Ù…ÙŠØªÙ†Ø¬ØŒ VIP)
            if (u.sessions) {
                Object.values(u.sessions).forEach(s => {
                    const parts = s.date.split('/');
                    const sessionDate = `${parts[2]}-${parts[1]}-${parts[0]}`;

                    if (sessionDate >= startDateVal && sessionDate <= endDateVal) {
                        const dur = parseInt(s.duration) || 0;
                        if (s.type === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || s.type === 'Ø·ÙˆØ§Ø±Ø¦') totalBreakTime += dur;
                        else if (s.type === 'ØµÙ„Ø§Ø©') totalPrayerTime += dur;
                        else if (s.type === 'Ù…ÙŠØªÙ†Ø¬') totalMeetingTime += dur;
                        else if (s.type === 'Ø§Ø³ØªØ±Ø§Ø­Ø© VIP') totalVIPTime += dur;
                    }
                });
            }

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† Ø³Ø¬Ù„ overtimeHistory
            if (u.overtimeHistory) {
                Object.values(u.overtimeHistory).forEach(ot => {
                    const parts = ot.date.split('/');
                    const otDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
                    if (otDate >= startDateVal && otDate <= endDateVal) {
                        totalOvertimeHours += parseFloat(ot.hours) || 0;
                    }
                });
            }

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙƒØ³Ø¯Ø© Ø§Ù„ØµØ§ÙÙŠØ© (ØªØ±Ø§ÙƒÙ…ÙŠ ÙŠÙˆÙ…ÙŠ)
            let totalOxidation = 0;
            if (u.sessions) {
                let dailyBreaks = {};
                Object.values(u.sessions).forEach(s => {
                    const parts = s.date.split('/');
                    const sDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
                    if (sDate >= startDateVal && sDate <= endDateVal) {
                        if (s.type === 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…' || s.type === 'Ø·ÙˆØ§Ø±Ø¦') {
                            dailyBreaks[s.date] = (dailyBreaks[s.date] || 0) + (parseInt(s.duration) || 0);
                        }
                    }
                });
                Object.values(dailyBreaks).forEach(dailyTotal => {
                    const allow = (u.allowance || 45) * 60;
                    if (dailyTotal > allow) totalOxidation += (dailyTotal - allow);
                });
            }

            if (u.complaints) {
                Object.values(u.complaints).forEach(c => {
                    const parts = c.date.split('/');
                    const compDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
                    if (compDate >= startDateVal && compDate <= endDateVal) {
                        complaintsCount++;
                        totalDeductions += parseFloat(c.amount) || 0;
                    }
                });
            }

            reportData.push({
                "Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù": u.realName || u.username,
                "Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰": complaintsCount,
                "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª": totalDeductions,
                "Ø§Ù„Ø£ÙƒØ³Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)": Math.round(totalOxidation / 60),
                "Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ (Ø³Ø§Ø¹Ø§Øª)": totalOvertimeHours, // Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                "Ø§Ù„ØµÙ„Ø§Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)": Math.round(totalPrayerTime / 60),
                "Ø§Ù„Ù…ÙŠØªÙ†Ø¬ (Ø¯Ù‚Ø§Ø¦Ù‚)": Math.round(totalMeetingTime / 60),
                "VIP (Ø¯Ù‚Ø§Ø¦Ù‚)": Math.round(totalVIPTime / 60)
            });
        });

        const worksheet = XLSX.utils.json_to_sheet(reportData);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ");
        XLSX.writeFile(workbook, `Report_${startDateVal}_to_${endDateVal}.xlsx`);
    }

    function autoConvertPrayerToBreak() {
        // Ø­Ù…Ø§ÙŠØ© Ø¹Ø´Ø§Ù† Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªØªÙƒØ±Ø±Ø´ Ø£Ù„Ù Ù…Ø±Ø© ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©
        if (window.isConvertingPrayer) return;
        window.isConvertingPrayer = true;

        const u = currentUser;
        const prayerLimitSeconds = 900; // 15 Ø¯Ù‚ÙŠÙ‚Ø©
        
        // ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø´Ø§Ù† ÙŠØ¹Ø±Ù Ø¥Ù† Ø§Ù„ÙˆÙ‚Øª Ø®Ù„Øµ
        const sound = document.getElementById('notifySound');
        if(sound) sound.play().catch(e => {});

        // 1. Ø­ÙØ¸ Ø¬Ù„Ø³Ø© Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ (Ø¹Ø´Ø§Ù† ØªØªØ­Ø³Ø¨ Ù„Ù‡ Ø¥Ù†Ù‡ ØµÙ„Ù‰)
        db.ref('users/' + u.username + '/sessions').push({
            date: getServerDateString(),
            type: 'ØµÙ„Ø§Ø©',
            reason: 'Ø§Ù†ØªÙ‡Ø§Ø¡ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© (15Ø¯)',
            duration: prayerLimitSeconds
        });

        // 2. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¸Ù:
        // - Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© 1
        // - ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù„Ù€ "Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…"
        // - ØªØµÙÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¹Ø´Ø§Ù† ÙŠØ¨Ø¯Ø£ ÙŠØ¹Ø¯ Ø¨Ø±ÙŠÙƒ Ù…Ù† Ø§Ù„ØµÙØ±
        const updates = {
            prayerCountToday: (u.prayerCountToday || 0) + 1, // ÙƒØ¯Ù‡ Ø­Ø³Ø¨Ù†Ø§ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø±Ø© Ø¯ÙŠ
            prayerSeconds: (u.prayerSeconds || 0) + prayerLimitSeconds, // Ø¶ÙŠÙÙ†Ø§ Ø§Ù„ÙˆÙ‚Øª Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØµÙ„ÙˆØ§ØªÙ‡
            breakType: 'Ø¨Ø±ÙŠÙƒ Ø¹Ø§Ù…', // Ø­ÙˆÙ„Ù†Ø§Ù‡ Ø¨Ø±ÙŠÙƒ
            lastStartTime: getServerTime(), // ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            lastReason: 'Ø£ÙƒØ³Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø© ğŸ•Œ'
        };

        db.ref('users/' + u.username).update(updates).then(() => {
            window.isConvertingPrayer = false;
            alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© (15 Ø¯Ù‚ÙŠÙ‚Ø©) ğŸ›‘\nØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ø§Ù„Ø¢Ù† Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„Ø¨Ø±ÙŠÙƒ Ø§Ù„Ø¹Ø§Ù…) ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.");
        });
    }

    /* ==========================================
       Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
       ========================================== */

    let prayerTimesData = null;
    let prayerInterval = null;

    // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ù† API (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©)
    async function fetchPrayerTimes() {
        try {
            const date = new Date();
            // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§) - Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ 5 (Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ±ÙŠØ©)
            const url = `https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}?latitude=30.0444&longitude=31.2357&method=5`;

            const response = await fetch(url);
            const data = await response.json();

            if (data && data.data && data.data.timings) {
                prayerTimesData = data.data.timings;
                renderPrayerList();
                startPrayerCountdown();
            }
        } catch (error) {
            console.error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©:", error);
            document.getElementById('nextPrayerName').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
        }
    }

    function renderPrayerList() {
        if (!prayerTimesData) return;

        // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ØªÙŠ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§
        const pNames = {
            Fajr: "Ø§Ù„ÙØ¬Ø±",
            Dhuhr: "Ø§Ù„Ø¸Ù‡Ø±",
            Asr: "Ø§Ù„Ø¹ØµØ±",
            Maghrib: "Ø§Ù„Ù…ØºØ±Ø¨",
            Isha: "Ø§Ù„Ø¹Ø´Ø§Ø¡"
        };

        const list = document.getElementById('prayerList');
        list.innerHTML = "";

        for (const [key, arName] of Object.entries(pNames)) {
            const time24 = prayerTimesData[key];
            // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ 12 Ø³Ø§Ø¹Ø©
            const timeParts = time24.split(':');
            let hours = parseInt(timeParts[0]);
            const minutes = timeParts[1];
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;

            list.innerHTML += `
                <li class="prayer-item" id="prayer-row-${key}">
                    <span>${arName}</span>
                    <span>${hours}:${minutes} <small>${ampm}</small></span>
                </li>
            `;
        }
    }

    function startPrayerCountdown() {
        if (prayerInterval) clearInterval(prayerInterval);

        prayerInterval = setInterval(() => {
            if (!prayerTimesData) return;

            const now = new Date();
            const pNames = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            const arNames = ['Ø§Ù„ÙØ¬Ø±', 'Ø§Ù„Ø¸Ù‡Ø±', 'Ø§Ù„Ø¹ØµØ±', 'Ø§Ù„Ù…ØºØ±Ø¨', 'Ø§Ù„Ø¹Ø´Ø§Ø¡'];

            let nextPrayerIndex = -1;
            let diffMs = 0;

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            for (let i = 0; i < pNames.length; i++) {
                const timeStr = prayerTimesData[pNames[i]];
                const [h, m] = timeStr.split(':');
                const pDate = new Date();
                pDate.setHours(h, m, 0, 0);

                if (pDate > now) {
                    nextPrayerIndex = i;
                    diffMs = pDate - now;
                    break;
                }
            }

            // Ù„Ùˆ Ø®Ù„ØµÙ†Ø§ ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù‡ÙŠ Ø§Ù„ÙØ¬Ø± Ø¨ÙƒØ±Ø©
            if (nextPrayerIndex === -1) {
                nextPrayerIndex = 0; // Ø§Ù„ÙØ¬Ø±
                const timeStr = prayerTimesData['Fajr'];
                const [h, m] = timeStr.split(':');
                const pDate = new Date();
                pDate.setDate(pDate.getDate() + 1); // Ø¨ÙƒØ±Ø©
                pDate.setHours(h, m, 0, 0);
                diffMs = pDate - now;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diffMs % (1000 * 60)) / 1000);

            document.getElementById('nextPrayerCount').innerText =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            document.getElementById('nextPrayerName').innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ ${arNames[nextPrayerIndex]}`;

            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            document.querySelectorAll('.prayer-item').forEach(item => {
                item.classList.remove('current-prayer', 'next-prayer-highlight');
            });
            const nextLi = document.getElementById(`prayer-row-${pNames[nextPrayerIndex]}`);
            nextLi.classList.add('next-prayer-highlight');
        }, 1000);
    }

    function togglePrayerWidget() {
        const widget = document.getElementById('prayerWidget');
        const btn = document.querySelector('.prayer-toggle-btn');
        widget.classList.toggle('active');
        btn.classList.toggle('active');
    }

    window.addEventListener('load', fetchPrayerTimes);

// Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function openSecretArchive() {
    // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ùˆ Ù…Ø´ Ù…Ø­Ù…ÙˆØ¯ Ø§Ø·Ø±Ø¯Ù‡
    if (currentUser.username !== 'mahmoud') {
        alert("â›” ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø±Ù…Ø©!");
        return;
    }

    document.getElementById('archiveModal').classList.remove('hidden');
    const tbody = document.getElementById('archiveBody');
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª... â³</td></tr>';

    // Ø¬Ù„Ø¨ Ø¢Ø®Ø± 100 Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù
    db.ref('admin_logs').limitToLast(100).once('value', snapshot => {
        const data = snapshot.val();
        tbody.innerHTML = '';

        if (!data) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Ø§Ù„Ø³Ø¬Ù„ Ù†Ø¸ÙŠÙ âœ…</td></tr>';
            return;
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù…ØµÙÙˆÙØ© ÙˆØ¹ÙƒØ³Ù‡Ø§ (Ø¹Ø´Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚)
        const logs = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);

        logs.forEach(log => {
            tbody.innerHTML += `
                <tr style="background:rgba(255,255,255,0.02); border-bottom:1px solid rgba(255,215,0,0.1);">
                    <td style="color:gold; font-weight:bold;">${log.adminName}</td>
                    <td style="color:#ef4444;">${log.action}</td>
                    <td>${log.target}</td>
                    <td style="font-size:0.9rem; color:#aaa;">${log.details}</td>
                    <td style="direction:ltr;">${log.dateStr}</td>
                </tr>
            `;
        });
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© showAdmin Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ø§Ù„Ø²Ø±Ø§Ø± Ù„Ù…Ø­Ù…ÙˆØ¯ Ø¨Ø³
// (Ù…Ù‡Ù…: Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¯Ø§Ù„Ø© showAdmin Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ ÙˆØ¶Ù Ø§Ù„Ø³Ø·Ø± Ø¯Ù‡ Ø¬ÙˆØ§Ù‡Ø§)
function showAdmin() {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('adminSection').classList.remove('hidden');

    // Ø§Ù„Ù…ÙƒØ§Ù†: Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© showAdmin()
    const managerNameEl = document.getElementById('currentManagerDisplay');
    const realName = currentUser.realName || currentUser.username;

    if (currentUser.username === 'mahmoud') {
        // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ù…Ø­Ù…ÙˆØ¯ (ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
        managerNameEl.innerHTML = `
            <span class="boss-crown">ğŸ‘‘</span>
            <span class="the-boss-name">${realName} (CEO)</span>
        `;
    } else {
        // Ù„Ùˆ Ø£ÙŠ Ù…Ø´Ø±Ù ØªØ§Ù†ÙŠ (Ø¹Ø§Ø¯ÙŠ)
        managerNameEl.innerText = `Ø§Ù„Ù…Ø´Ø±Ù: ${realName}`;
        managerNameEl.style.color = ""; // Ø±ÙŠØ³Øª Ù„Ù„Ø£Ù„ÙˆØ§Ù†
        managerNameEl.className = "";   // Ø±ÙŠØ³Øª Ù„Ù„ÙƒÙ„Ø§Ø³Ø§Øª
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø±ÙŠ Ù„Ù…Ø­Ù…ÙˆØ¯ ÙÙ‚Ø·
    if (currentUser.username === 'mahmoud') {
        document.getElementById('secretResetBtn').classList.remove('hidden');
    } else {
        document.getElementById('secretResetBtn').classList.add('hidden');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø³Ø±ÙŠ Ù„Ù…Ø­Ù…ÙˆØ¯ ÙÙ‚Ø·
    if (currentUser.username === 'mahmoud') {
        document.getElementById('secretArchiveBtn').classList.remove('hidden');
    } else {
        document.getElementById('secretArchiveBtn').classList.add('hidden');
    }

    switchAdminTab('monitor');
    startGlobalTimer();
}
</script>
<!-- Ù…ÙƒØªØ¨Ø© SheetJS Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</body>
</html> 
